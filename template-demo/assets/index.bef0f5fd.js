var t=Object.defineProperty,e=(e,n,r)=>(((e,n,r)=>{n in e?t(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r})(e,"symbol"!=typeof n?n+"":n,r),r);import{al as n,p as r,am as o,z as i,an as a,E as s,l,ao as u,ap as c,aq as f,H as h,x as p,k as d,a5 as m,ar as v,Y as g,G as y,as as w,at as x,Z as b,q as I,c as T,ai as S,a8 as C,au as P,v as A,av as k,M,L as D,t as E,aw as F,d as L,B as z,F as O,ax as R,ay as N,az as _,U as B,aA as U,aB as j,aC as G,aD as V,aE as X,y as W,j as H,i as Y,C as Z,aF as K,A as q,m as $,a9 as Q,S as J,W as tt,a1 as et}from"./three.module.18d565c0.js";import{O as nt}from"./OrbitControls.374a84f0.js";import{n as rt}from"./index.553d5c6b.js";import"./vendor.63663422.js";var ot={},it=function(t){return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))},at=function(t){return new Worker(t)};
/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/try{URL.revokeObjectURL(it(""))}catch(ir){it=function(t){return"data:application/javascript;charset=UTF-8,"+encodeURI(t)},at=function(t){return new Worker(t,{type:"module"})}}var st=Uint8Array,lt=Uint16Array,ut=Uint32Array,ct=new st([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ft=new st([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ht=new st([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),pt=function(t,e){for(var n=new lt(31),r=0;r<31;++r)n[r]=e+=1<<t[r-1];var o=new ut(n[30]);for(r=1;r<30;++r)for(var i=n[r];i<n[r+1];++i)o[i]=i-n[r]<<5|r;return[n,o]},dt=pt(ct,2),mt=dt[0],vt=dt[1];mt[28]=258,vt[258]=28;for(var gt=pt(ft,0),yt=gt[0],wt=gt[1],xt=new lt(32768),bt=0;bt<32768;++bt){var It=(43690&bt)>>>1|(21845&bt)<<1;It=(61680&(It=(52428&It)>>>2|(13107&It)<<2))>>>4|(3855&It)<<4,xt[bt]=((65280&It)>>>8|(255&It)<<8)>>>1}var Tt=function(t,e,n){for(var r=t.length,o=0,i=new lt(e);o<r;++o)++i[t[o]-1];var a,s=new lt(e);for(o=0;o<e;++o)s[o]=s[o-1]+i[o-1]<<1;if(n){a=new lt(1<<e);var l=15-e;for(o=0;o<r;++o)if(t[o])for(var u=o<<4|t[o],c=e-t[o],f=s[t[o]-1]++<<c,h=f|(1<<c)-1;f<=h;++f)a[xt[f]>>>l]=u}else for(a=new lt(r),o=0;o<r;++o)t[o]&&(a[o]=xt[s[t[o]-1]++]>>>15-t[o]);return a},St=new st(288);for(bt=0;bt<144;++bt)St[bt]=8;for(bt=144;bt<256;++bt)St[bt]=9;for(bt=256;bt<280;++bt)St[bt]=7;for(bt=280;bt<288;++bt)St[bt]=8;var Ct=new st(32);for(bt=0;bt<32;++bt)Ct[bt]=5;var Pt=Tt(St,9,0),At=Tt(St,9,1),kt=Tt(Ct,5,0),Mt=Tt(Ct,5,1),Dt=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},Et=function(t,e,n){var r=e/8|0;return(t[r]|t[r+1]<<8)>>(7&e)&n},Ft=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(7&e)},Lt=function(t){return(t/8|0)+(7&t&&1)},zt=function(t,e,n){(null==e||e<0)&&(e=0),(null==n||n>t.length)&&(n=t.length);var r=new(t instanceof lt?lt:t instanceof ut?ut:st)(n-e);return r.set(t.subarray(e,n)),r},Ot=function(t,e,n){var r=t.length;if(!r||n&&!n.l&&r<5)return e||new st(0);var o=!e||n,i=!n||n.i;n||(n={}),e||(e=new st(3*r));var a=function(t){var n=e.length;if(t>n){var r=new st(Math.max(2*n,t));r.set(e),e=r}},s=n.f||0,l=n.p||0,u=n.b||0,c=n.l,f=n.d,h=n.m,p=n.n,d=8*r;do{if(!c){n.f=s=Et(t,l,1);var m=Et(t,l+1,3);if(l+=3,!m){var v=t[(A=Lt(l)+4)-4]|t[A-3]<<8,g=A+v;if(g>r){if(i)throw"unexpected EOF";break}o&&a(u+v),e.set(t.subarray(A,g),u),n.b=u+=v,n.p=l=8*g;continue}if(1==m)c=At,f=Mt,h=9,p=5;else{if(2!=m)throw"invalid block type";var y=Et(t,l,31)+257,w=Et(t,l+10,15)+4,x=y+Et(t,l+5,31)+1;l+=14;for(var b=new st(x),I=new st(19),T=0;T<w;++T)I[ht[T]]=Et(t,l+3*T,7);l+=3*w;var S=Dt(I),C=(1<<S)-1,P=Tt(I,S,1);for(T=0;T<x;){var A,k=P[Et(t,l,C)];if(l+=15&k,(A=k>>>4)<16)b[T++]=A;else{var M=0,D=0;for(16==A?(D=3+Et(t,l,3),l+=2,M=b[T-1]):17==A?(D=3+Et(t,l,7),l+=3):18==A&&(D=11+Et(t,l,127),l+=7);D--;)b[T++]=M}}var E=b.subarray(0,y),F=b.subarray(y);h=Dt(E),p=Dt(F),c=Tt(E,h,1),f=Tt(F,p,1)}if(l>d){if(i)throw"unexpected EOF";break}}o&&a(u+131072);for(var L=(1<<h)-1,z=(1<<p)-1,O=l;;O=l){var R=(M=c[Ft(t,l)&L])>>>4;if((l+=15&M)>d){if(i)throw"unexpected EOF";break}if(!M)throw"invalid length/literal";if(R<256)e[u++]=R;else{if(256==R){O=l,c=null;break}var N=R-254;if(R>264){var _=ct[T=R-257];N=Et(t,l,(1<<_)-1)+mt[T],l+=_}var B=f[Ft(t,l)&z],U=B>>>4;if(!B)throw"invalid distance";l+=15&B;F=yt[U];if(U>3){_=ft[U];F+=Ft(t,l)&(1<<_)-1,l+=_}if(l>d){if(i)throw"unexpected EOF";break}o&&a(u+131072);for(var j=u+N;u<j;u+=4)e[u]=e[u-F],e[u+1]=e[u+1-F],e[u+2]=e[u+2-F],e[u+3]=e[u+3-F];u=j}}n.l=c,n.p=O,n.b=u,c&&(s=1,n.m=h,n.d=f,n.n=p)}while(!s);return u==e.length?e:zt(e,0,u)},Rt=function(t,e,n){n<<=7&e;var r=e/8|0;t[r]|=n,t[r+1]|=n>>>8},Nt=function(t,e,n){n<<=7&e;var r=e/8|0;t[r]|=n,t[r+1]|=n>>>8,t[r+2]|=n>>>16},_t=function(t,e){for(var n=[],r=0;r<t.length;++r)t[r]&&n.push({s:r,f:t[r]});var o=n.length,i=n.slice();if(!o)return[Wt,0];if(1==o){var a=new st(n[0].s+1);return a[n[0].s]=1,[a,1]}n.sort((function(t,e){return t.f-e.f})),n.push({s:-1,f:25001});var s=n[0],l=n[1],u=0,c=1,f=2;for(n[0]={s:-1,f:s.f+l.f,l:s,r:l};c!=o-1;)s=n[n[u].f<n[f].f?u++:f++],l=n[u!=c&&n[u].f<n[f].f?u++:f++],n[c++]={s:-1,f:s.f+l.f,l:s,r:l};var h=i[0].s;for(r=1;r<o;++r)i[r].s>h&&(h=i[r].s);var p=new lt(h+1),d=Bt(n[c-1],p,0);if(d>e){r=0;var m=0,v=d-e,g=1<<v;for(i.sort((function(t,e){return p[e.s]-p[t.s]||t.f-e.f}));r<o;++r){var y=i[r].s;if(!(p[y]>e))break;m+=g-(1<<d-p[y]),p[y]=e}for(m>>>=v;m>0;){var w=i[r].s;p[w]<e?m-=1<<e-p[w]++-1:++r}for(;r>=0&&m;--r){var x=i[r].s;p[x]==e&&(--p[x],++m)}d=e}return[new st(p),d]},Bt=function(t,e,n){return-1==t.s?Math.max(Bt(t.l,e,n+1),Bt(t.r,e,n+1)):e[t.s]=n},Ut=function(t){for(var e=t.length;e&&!t[--e];);for(var n=new lt(++e),r=0,o=t[0],i=1,a=function(t){n[r++]=t},s=1;s<=e;++s)if(t[s]==o&&s!=e)++i;else{if(!o&&i>2){for(;i>138;i-=138)a(32754);i>2&&(a(i>10?i-11<<5|28690:i-3<<5|12305),i=0)}else if(i>3){for(a(o),--i;i>6;i-=6)a(8304);i>2&&(a(i-3<<5|8208),i=0)}for(;i--;)a(o);i=1,o=t[s]}return[n.subarray(0,r),e]},jt=function(t,e){for(var n=0,r=0;r<e.length;++r)n+=t[r]*e[r];return n},Gt=function(t,e,n){var r=n.length,o=Lt(e+2);t[o]=255&r,t[o+1]=r>>>8,t[o+2]=255^t[o],t[o+3]=255^t[o+1];for(var i=0;i<r;++i)t[o+i+4]=n[i];return 8*(o+4+r)},Vt=function(t,e,n,r,o,i,a,s,l,u,c){Rt(e,c++,n),++o[256];for(var f=_t(o,15),h=f[0],p=f[1],d=_t(i,15),m=d[0],v=d[1],g=Ut(h),y=g[0],w=g[1],x=Ut(m),b=x[0],I=x[1],T=new lt(19),S=0;S<y.length;++S)T[31&y[S]]++;for(S=0;S<b.length;++S)T[31&b[S]]++;for(var C=_t(T,7),P=C[0],A=C[1],k=19;k>4&&!P[ht[k-1]];--k);var M,D,E,F,L=u+5<<3,z=jt(o,St)+jt(i,Ct)+a,O=jt(o,h)+jt(i,m)+a+14+3*k+jt(T,P)+(2*T[16]+3*T[17]+7*T[18]);if(L<=z&&L<=O)return Gt(e,c,t.subarray(l,l+u));if(Rt(e,c,1+(O<z)),c+=2,O<z){M=Tt(h,p,0),D=h,E=Tt(m,v,0),F=m;var R=Tt(P,A,0);Rt(e,c,w-257),Rt(e,c+5,I-1),Rt(e,c+10,k-4),c+=14;for(S=0;S<k;++S)Rt(e,c+3*S,P[ht[S]]);c+=3*k;for(var N=[y,b],_=0;_<2;++_){var B=N[_];for(S=0;S<B.length;++S){var U=31&B[S];Rt(e,c,R[U]),c+=P[U],U>15&&(Rt(e,c,B[S]>>>5&127),c+=B[S]>>>12)}}}else M=Pt,D=St,E=kt,F=Ct;for(S=0;S<s;++S)if(r[S]>255){U=r[S]>>>18&31;Nt(e,c,M[U+257]),c+=D[U+257],U>7&&(Rt(e,c,r[S]>>>23&31),c+=ct[U]);var j=31&r[S];Nt(e,c,E[j]),c+=F[j],j>3&&(Nt(e,c,r[S]>>>5&8191),c+=ft[j])}else Nt(e,c,M[r[S]]),c+=D[r[S]];return Nt(e,c,M[256]),c+D[256]},Xt=new ut([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Wt=new st(0),Ht=function(t,e,n,r,o,i){var a=t.length,s=new st(r+a+5*(1+Math.ceil(a/7e3))+o),l=s.subarray(r,s.length-o),u=0;if(!e||a<8)for(var c=0;c<=a;c+=65535){var f=c+65535;f<a?u=Gt(l,u,t.subarray(c,f)):(l[c]=i,u=Gt(l,u,t.subarray(c,a)))}else{for(var h=Xt[e-1],p=h>>>13,d=8191&h,m=(1<<n)-1,v=new lt(32768),g=new lt(m+1),y=Math.ceil(n/3),w=2*y,x=function(e){return(t[e]^t[e+1]<<y^t[e+2]<<w)&m},b=new ut(25e3),I=new lt(288),T=new lt(32),S=0,C=0,P=(c=0,0),A=0,k=0;c<a;++c){var M=x(c),D=32767&c,E=g[M];if(v[D]=E,g[M]=D,A<=c){var F=a-c;if((S>7e3||P>24576)&&F>423){u=Vt(t,l,0,b,I,T,C,P,k,c-k,u),P=S=C=0,k=c;for(var L=0;L<286;++L)I[L]=0;for(L=0;L<30;++L)T[L]=0}var z=2,O=0,R=d,N=D-E&32767;if(F>2&&M==x(c-N))for(var _=Math.min(p,F)-1,B=Math.min(32767,c),U=Math.min(258,F);N<=B&&--R&&D!=E;){if(t[c+z]==t[c+z-N]){for(var j=0;j<U&&t[c+j]==t[c+j-N];++j);if(j>z){if(z=j,O=N,j>_)break;var G=Math.min(N,j-2),V=0;for(L=0;L<G;++L){var X=c-N+L+32768&32767,W=X-v[X]+32768&32767;W>V&&(V=W,E=X)}}}N+=(D=E)-(E=v[D])+32768&32767}if(O){b[P++]=268435456|vt[z]<<18|wt[O];var H=31&vt[z],Y=31&wt[O];C+=ct[H]+ft[Y],++I[257+H],++T[Y],A=c+z,++S}else b[P++]=t[c],++I[t[c]]}}u=Vt(t,l,i,b,I,T,C,P,k,c-k,u),!i&&7&u&&(u=Gt(l,u+1,Wt))}return zt(s,0,r+Lt(u)+o)},Yt=function(){for(var t=new ut(256),e=0;e<256;++e){for(var n=e,r=9;--r;)n=(1&n&&3988292384)^n>>>1;t[e]=n}return t}(),Zt=function(){var t=-1;return{p:function(e){for(var n=t,r=0;r<e.length;++r)n=Yt[255&n^e[r]]^n>>>8;t=n},d:function(){return~t}}},Kt=function(){var t=1,e=0;return{p:function(n){for(var r=t,o=e,i=n.length,a=0;a!=i;){for(var s=Math.min(a+2655,i);a<s;++a)o+=r+=n[a];r=(65535&r)+15*(r>>16),o=(65535&o)+15*(o>>16)}t=r,e=o},d:function(){return(255&(t%=65521))<<24|t>>>8<<16|(255&(e%=65521))<<8|e>>>8}}},qt=function(t,e,n,r,o){return Ht(t,null==e.level?6:e.level,null==e.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(t.length)))):12+e.mem,n,r,!o)},$t=function(t,e){var n={};for(var r in t)n[r]=t[r];for(var r in e)n[r]=e[r];return n},Qt=function(t,e,n){for(var r=t(),o=t.toString(),i=o.slice(o.indexOf("[")+1,o.lastIndexOf("]")).replace(/ /g,"").split(","),a=0;a<r.length;++a){var s=r[a],l=i[a];if("function"==typeof s){e+=";"+l+"=";var u=s.toString();if(s.prototype)if(-1!=u.indexOf("[native code]")){var c=u.indexOf(" ",8)+1;e+=u.slice(c,u.indexOf("(",c))}else for(var f in e+=u,s.prototype)e+=";"+l+".prototype."+f+"="+s.prototype[f].toString();else e+=u}else n[l]=s}return[e,n]},Jt=[],te=function(t,e,n,r){var o;if(!Jt[n]){for(var i="",a={},s=t.length-1,l=0;l<s;++l)i=(o=Qt(t[l],i,a))[0],a=o[1];Jt[n]=Qt(t[s],i,a)}var u=$t({},Jt[n][1]);return function(t,e,n,r,o){var i=at(ot[e]||(ot[e]=it(t)));return i.onerror=function(t){return o(t.error,null)},i.onmessage=function(t){return o(null,t.data)},i.postMessage(n,r),i}(Jt[n][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",n,u,function(t){var e=[];for(var n in t)(t[n]instanceof st||t[n]instanceof lt||t[n]instanceof ut)&&e.push((t[n]=new t[n].constructor(t[n])).buffer);return e}(u),r)},ee=function(){return[st,lt,ut,ct,ft,ht,mt,yt,At,Mt,xt,Tt,Dt,Et,Ft,Lt,zt,Ot,De,se,le]},ne=function(){return[st,lt,ut,ct,ft,ht,vt,wt,Pt,St,kt,Ct,xt,Xt,Wt,Tt,Rt,Nt,_t,Bt,Ut,jt,Gt,Vt,Lt,zt,Ht,qt,Pe,se]},re=function(){return[ve,we,me,Zt,Yt]},oe=function(){return[ge,ye]},ie=function(){return[xe,me,Kt]},ae=function(){return[be]},se=function(t){return postMessage(t,[t.buffer])},le=function(t){return t&&t.size&&new st(t.size)},ue=function(t,e,n,r,o,i){var a=te(n,r,o,(function(t,e){a.terminate(),i(t,e)}));return a.postMessage([t,e],e.consume?[t.buffer]:[]),function(){a.terminate()}},ce=function(t){return t.ondata=function(t,e){return postMessage([t,e],[t.buffer])},function(e){return t.push(e.data[0],e.data[1])}},fe=function(t,e,n,r,o){var i,a=te(t,r,o,(function(t,n){t?(a.terminate(),e.ondata.call(e,t)):(n[1]&&a.terminate(),e.ondata.call(e,t,n[0],n[1]))}));a.postMessage(n),e.push=function(t,n){if(i)throw"stream finished";if(!e.ondata)throw"no stream handler";a.postMessage([t,i=n],[t.buffer])},e.terminate=function(){a.terminate()}},he=function(t,e){return t[e]|t[e+1]<<8},pe=function(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0},de=function(t,e){return pe(t,e)+4294967296*pe(t,e+4)},me=function(t,e,n){for(;n;++e)t[e]=n,n>>>=8},ve=function(t,e){var n=e.filename;if(t[0]=31,t[1]=139,t[2]=8,t[8]=e.level<2?4:9==e.level?2:0,t[9]=3,0!=e.mtime&&me(t,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),n){t[3]=8;for(var r=0;r<=n.length;++r)t[r+10]=n.charCodeAt(r)}},ge=function(t){if(31!=t[0]||139!=t[1]||8!=t[2])throw"invalid gzip data";var e=t[3],n=10;4&e&&(n+=t[10]|2+(t[11]<<8));for(var r=(e>>3&1)+(e>>4&1);r>0;r-=!t[n++]);return n+(2&e)},ye=function(t){var e=t.length;return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0},we=function(t){return 10+(t.filename&&t.filename.length+1||0)},xe=function(t,e){var n=e.level,r=0==n?0:n<6?1:9==n?3:2;t[0]=120,t[1]=r<<6|(r?32-2*r:1)},be=function(t){if(8!=(15&t[0])||t[0]>>>4>7||(t[0]<<8|t[1])%31)throw"invalid zlib data";if(32&t[1])throw"invalid zlib data: preset dictionaries not supported"};function Ie(t,e){return e||"function"!=typeof t||(e=t,t={}),this.ondata=e,t}var Te=function(){function t(t,e){e||"function"!=typeof t||(e=t,t={}),this.ondata=e,this.o=t||{}}return t.prototype.p=function(t,e){this.ondata(qt(t,this.o,0,0,!e),e)},t.prototype.push=function(t,e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=e,this.p(t,e||!1)},t}(),Se=function(){return function(t,e){fe([ne,function(){return[ce,Te]}],this,Ie.call(this,t,e),(function(t){var e=new Te(t.data);onmessage=ce(e)}),6)}}();function Ce(t,e,n){if(n||(n=e,e={}),"function"!=typeof n)throw"no callback";return ue(t,e,[ne],(function(t){return se(Pe(t.data[0],t.data[1]))}),0,n)}function Pe(t,e){return qt(t,e||{},0,0)}var Ae=function(){function t(t){this.s={},this.p=new st(0),this.ondata=t}return t.prototype.e=function(t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var e=this.p.length,n=new st(e+t.length);n.set(this.p),n.set(t,e),this.p=n},t.prototype.c=function(t){this.d=this.s.i=t||!1;var e=this.s.b,n=Ot(this.p,this.o,this.s);this.ondata(zt(n,e,this.s.b),this.d),this.o=zt(n,this.s.b-32768),this.s.b=this.o.length,this.p=zt(this.p,this.s.p/8|0),this.s.p&=7},t.prototype.push=function(t,e){this.e(t),this.c(e)},t}(),ke=function(){return function(t){this.ondata=t,fe([ee,function(){return[ce,Ae]}],this,0,(function(){var t=new Ae;onmessage=ce(t)}),7)}}();function Me(t,e,n){if(n||(n=e,e={}),"function"!=typeof n)throw"no callback";return ue(t,e,[ee],(function(t){return se(De(t.data[0],le(t.data[1])))}),1,n)}function De(t,e){return Ot(t,e)}var Ee=function(){function t(t,e){this.c=Zt(),this.l=0,this.v=1,Te.call(this,t,e)}return t.prototype.push=function(t,e){Te.prototype.push.call(this,t,e)},t.prototype.p=function(t,e){this.c.p(t),this.l+=t.length;var n=qt(t,this.o,this.v&&we(this.o),e&&8,!e);this.v&&(ve(n,this.o),this.v=0),e&&(me(n,n.length-8,this.c.d()),me(n,n.length-4,this.l)),this.ondata(n,e)},t}(),Fe=function(){return function(t,e){fe([ne,re,function(){return[ce,Te,Ee]}],this,Ie.call(this,t,e),(function(t){var e=new Ee(t.data);onmessage=ce(e)}),8)}}();function Le(t,e,n){if(n||(n=e,e={}),"function"!=typeof n)throw"no callback";return ue(t,e,[ne,re,function(){return[ze]}],(function(t){return se(ze(t.data[0],t.data[1]))}),2,n)}function ze(t,e){e||(e={});var n=Zt(),r=t.length;n.p(t);var o=qt(t,e,we(e),8),i=o.length;return ve(o,e),me(o,i-8,n.d()),me(o,i-4,r),o}var Oe=function(){function t(t){this.v=1,Ae.call(this,t)}return t.prototype.push=function(t,e){if(Ae.prototype.e.call(this,t),this.v){var n=this.p.length>3?ge(this.p):4;if(n>=this.p.length&&!e)return;this.p=this.p.subarray(n),this.v=0}if(e){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}Ae.prototype.c.call(this,e)},t}(),Re=function(){return function(t){this.ondata=t,fe([ee,oe,function(){return[ce,Ae,Oe]}],this,0,(function(){var t=new Oe;onmessage=ce(t)}),9)}}();function Ne(t,e,n){if(n||(n=e,e={}),"function"!=typeof n)throw"no callback";return ue(t,e,[ee,oe,function(){return[_e]}],(function(t){return se(_e(t.data[0]))}),3,n)}function _e(t,e){return Ot(t.subarray(ge(t),-8),e||new st(ye(t)))}var Be=function(){function t(t,e){this.c=Kt(),this.v=1,Te.call(this,t,e)}return t.prototype.push=function(t,e){Te.prototype.push.call(this,t,e)},t.prototype.p=function(t,e){this.c.p(t);var n=qt(t,this.o,this.v&&2,e&&4,!e);this.v&&(xe(n,this.o),this.v=0),e&&me(n,n.length-4,this.c.d()),this.ondata(n,e)},t}(),Ue=function(){return function(t,e){fe([ne,ie,function(){return[ce,Te,Be]}],this,Ie.call(this,t,e),(function(t){var e=new Be(t.data);onmessage=ce(e)}),10)}}();function je(t,e){e||(e={});var n=Kt();n.p(t);var r=qt(t,e,2,4);return xe(r,e),me(r,r.length-4,n.d()),r}var Ge=function(){function t(t){this.v=1,Ae.call(this,t)}return t.prototype.push=function(t,e){if(Ae.prototype.e.call(this,t),this.v){if(this.p.length<2&&!e)return;this.p=this.p.subarray(2),this.v=0}if(e){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}Ae.prototype.c.call(this,e)},t}(),Ve=function(){return function(t){this.ondata=t,fe([ee,ae,function(){return[ce,Ae,Ge]}],this,0,(function(){var t=new Ge;onmessage=ce(t)}),11)}}();function Xe(t,e,n){if(n||(n=e,e={}),"function"!=typeof n)throw"no callback";return ue(t,e,[ee,ae,function(){return[We]}],(function(t){return se(We(t.data[0],le(t.data[1])))}),5,n)}function We(t,e){return Ot((be(t),t.subarray(2,-4)),e)}var He=function(){function t(t){this.G=Oe,this.I=Ae,this.Z=Ge,this.ondata=t}return t.prototype.push=function(t,e){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(t,e);else{if(this.p&&this.p.length){var n=new st(this.p.length+t.length);n.set(this.p),n.set(t,this.p.length)}else this.p=t;if(this.p.length>2){var r=this,o=function(){r.ondata.apply(r,arguments)};this.s=31==this.p[0]&&139==this.p[1]&&8==this.p[2]?new this.G(o):8!=(15&this.p[0])||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(o):new this.Z(o),this.s.push(this.p,e),this.p=null}}},t}(),Ye=function(){function t(t){this.G=Re,this.I=ke,this.Z=Ve,this.ondata=t}return t.prototype.push=function(t,e){He.prototype.push.call(this,t,e)},t}();var Ze=function(t,e,n,r){for(var o in t){var i=t[o],a=e+o;i instanceof st?n[a]=[i,r]:Array.isArray(i)?n[a]=[i[0],$t(r,i[1])]:Ze(i,a+"/",n,r)}},Ke="undefined"!=typeof TextEncoder&&new TextEncoder,qe="undefined"!=typeof TextDecoder&&new TextDecoder,$e=0;try{qe.decode(Wt,{stream:!0}),$e=1}catch(ir){}var Qe=function(t){for(var e="",n=0;;){var r=t[n++],o=(r>127)+(r>223)+(r>239);if(n+o>t.length)return[e,zt(t,n-1)];o?3==o?(r=((15&r)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536,e+=String.fromCharCode(55296|r>>10,56320|1023&r)):e+=1&o?String.fromCharCode((31&r)<<6|63&t[n++]):String.fromCharCode((15&r)<<12|(63&t[n++])<<6|63&t[n++]):e+=String.fromCharCode(r)}},Je=function(){function t(t){this.ondata=t,$e?this.t=new TextDecoder:this.p=Wt}return t.prototype.push=function(t,e){if(!this.ondata)throw"no callback";if(e=!!e,this.t){if(this.ondata(this.t.decode(t,{stream:!0}),e),e){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var n=new st(this.p.length+t.length);n.set(this.p),n.set(t,this.p.length);var r=Qe(n),o=r[0],i=r[1];if(e){if(i.length)throw"invalid utf-8 data";this.p=null}else this.p=i;this.ondata(o,e)}},t}(),tn=function(){function t(t){this.ondata=t}return t.prototype.push=function(t,e){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(en(t),this.d=e||!1)},t}();function en(t,e){if(e){for(var n=new st(t.length),r=0;r<t.length;++r)n[r]=t.charCodeAt(r);return n}if(Ke)return Ke.encode(t);var o=t.length,i=new st(t.length+(t.length>>1)),a=0,s=function(t){i[a++]=t};for(r=0;r<o;++r){if(a+5>i.length){var l=new st(a+8+(o-r<<1));l.set(i),i=l}var u=t.charCodeAt(r);u<128||e?s(u):u<2048?(s(192|u>>6),s(128|63&u)):u>55295&&u<57344?(s(240|(u=65536+(1047552&u)|1023&t.charCodeAt(++r))>>18),s(128|u>>12&63),s(128|u>>6&63),s(128|63&u)):(s(224|u>>12),s(128|u>>6&63),s(128|63&u))}return zt(i,0,a)}function nn(t,e){if(e){for(var n="",r=0;r<t.length;r+=16384)n+=String.fromCharCode.apply(null,t.subarray(r,r+16384));return n}if(qe)return qe.decode(t);var o=Qe(t),i=o[0];if(o[1].length)throw"invalid utf-8 data";return i}var rn=function(t){return 1==t?3:t<6?2:9==t?1:0},on=function(t,e){return e+30+he(t,e+26)+he(t,e+28)},an=function(t,e,n){var r=he(t,e+28),o=nn(t.subarray(e+46,e+46+r),!(2048&he(t,e+8))),i=e+46+r,a=pe(t,e+20),s=n&&4294967295==a?sn(t,i):[a,pe(t,e+24),pe(t,e+42)],l=s[0],u=s[1],c=s[2];return[he(t,e+10),l,u,o,i+he(t,e+30)+he(t,e+32),c]},sn=function(t,e){for(;1!=he(t,e);e+=4+he(t,e+2));return[de(t,e+12),de(t,e+4),de(t,e+20)]},ln=function(t){var e=0;if(t)for(var n in t){var r=t[n].length;if(r>65535)throw"extra field too long";e+=r+4}return e},un=function(t,e,n,r,o,i,a,s){var l=r.length,u=n.extra,c=s&&s.length,f=ln(u);me(t,e,null!=a?33639248:67324752),e+=4,null!=a&&(t[e++]=20,t[e++]=n.os),t[e]=20,e+=2,t[e++]=n.flag<<1|(null==i&&8),t[e++]=o&&8,t[e++]=255&n.compression,t[e++]=n.compression>>8;var h=new Date(null==n.mtime?Date.now():n.mtime),p=h.getFullYear()-1980;if(p<0||p>119)throw"date not in range 1980-2099";if(me(t,e,p<<25|h.getMonth()+1<<21|h.getDate()<<16|h.getHours()<<11|h.getMinutes()<<5|h.getSeconds()>>>1),e+=4,null!=i&&(me(t,e,n.crc),me(t,e+4,i),me(t,e+8,n.size)),me(t,e+12,l),me(t,e+14,f),e+=16,null!=a&&(me(t,e,c),me(t,e+6,n.attrs),me(t,e+10,a),e+=14),t.set(r,e),e+=l,f)for(var d in u){var m=u[d],v=m.length;me(t,e,+d),me(t,e+2,v),t.set(m,e+4),e+=4+v}return c&&(t.set(s,e),e+=c),e},cn=function(t,e,n,r,o){me(t,e,101010256),me(t,e+8,n),me(t,e+10,n),me(t,e+12,r),me(t,e+16,o)},fn=function(){function t(t){this.filename=t,this.c=Zt(),this.size=0,this.compression=0}return t.prototype.process=function(t,e){this.ondata(null,t,e)},t.prototype.push=function(t,e){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(t),this.size+=t.length,e&&(this.crc=this.c.d()),this.process(t,e||!1)},t}(),hn=function(){function t(t,e){var n=this;e||(e={}),fn.call(this,t),this.d=new Te(e,(function(t,e){n.ondata(null,t,e)})),this.compression=8,this.flag=rn(e.level)}return t.prototype.process=function(t,e){try{this.d.push(t,e)}catch(ir){this.ondata(ir,null,e)}},t.prototype.push=function(t,e){fn.prototype.push.call(this,t,e)},t}(),pn=function(){function t(t,e){var n=this;e||(e={}),fn.call(this,t),this.d=new Se(e,(function(t,e,r){n.ondata(t,e,r)})),this.compression=8,this.flag=rn(e.level),this.terminate=this.d.terminate}return t.prototype.process=function(t,e){this.d.push(t,e)},t.prototype.push=function(t,e){fn.prototype.push.call(this,t,e)},t}(),dn=function(){function t(t){this.ondata=t,this.u=[],this.d=1}return t.prototype.add=function(t){var e=this;if(2&this.d)throw"stream finished";var n=en(t.filename),r=n.length,o=t.comment,i=o&&en(o),a=r!=t.filename.length||i&&o.length!=i.length,s=r+ln(t.extra)+30;if(r>65535)throw"filename too long";var l=new st(s);un(l,0,t,n,a);var u=[l],c=function(){for(var t=0,n=u;t<n.length;t++){var r=n[t];e.ondata(null,r,!1)}u=[]},f=this.d;this.d=0;var h=this.u.length,p=$t(t,{f:n,u:a,o:i,t:function(){t.terminate&&t.terminate()},r:function(){if(c(),f){var t=e.u[h+1];t?t.r():e.d=1}f=1}}),d=0;t.ondata=function(n,r,o){if(n)e.ondata(n,r,o),e.terminate();else if(d+=r.length,u.push(r),o){var i=new st(16);me(i,0,134695760),me(i,4,t.crc),me(i,8,d),me(i,12,t.size),u.push(i),p.c=d,p.b=s+d+16,p.crc=t.crc,p.size=t.size,f&&p.r(),f=1}else f&&c()},this.u.push(p)},t.prototype.end=function(){var t=this;if(2&this.d){if(1&this.d)throw"stream finishing";throw"stream finished"}this.d?this.e():this.u.push({r:function(){1&t.d&&(t.u.splice(-1,1),t.e())},t:function(){}}),this.d=3},t.prototype.e=function(){for(var t=0,e=0,n=0,r=0,o=this.u;r<o.length;r++){n+=46+(l=o[r]).f.length+ln(l.extra)+(l.o?l.o.length:0)}for(var i=new st(n+22),a=0,s=this.u;a<s.length;a++){var l=s[a];un(i,t,l,l.f,l.u,l.c,e,l.o),t+=46+l.f.length+ln(l.extra)+(l.o?l.o.length:0),e+=l.b}cn(i,t,this.u.length,n,e),this.ondata(null,i,!0),this.d=2},t.prototype.terminate=function(){for(var t=0,e=this.u;t<e.length;t++){e[t].t()}this.d=2},t}();var mn=function(){function t(){}return t.prototype.push=function(t,e){this.ondata(null,t,e)},t.compression=0,t}(),vn=function(){function t(){var t=this;this.i=new Ae((function(e,n){t.ondata(null,e,n)}))}return t.prototype.push=function(t,e){try{this.i.push(t,e)}catch(ir){this.ondata(ir,t,e)}},t.compression=8,t}(),gn=function(){function t(t,e){var n=this;e<32e4?this.i=new Ae((function(t,e){n.ondata(null,t,e)})):(this.i=new ke((function(t,e,r){n.ondata(t,e,r)})),this.terminate=this.i.terminate)}return t.prototype.push=function(t,e){this.i.terminate&&(t=zt(t,0)),this.i.push(t,e)},t.compression=8,t}(),yn=function(){function t(t){this.onfile=t,this.k=[],this.o={0:mn},this.p=Wt}return t.prototype.push=function(t,e){var n=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var r=Math.min(this.c,t.length),o=t.subarray(0,r);if(this.c-=r,this.d?this.d.push(o,!this.c):this.k[0].push(o),(t=t.subarray(r)).length)return this.push(t,e)}else{var i=0,a=0,s=void 0,l=void 0;this.p.length?t.length?((l=new st(this.p.length+t.length)).set(this.p),l.set(t,this.p.length)):l=this.p:l=t;for(var u=l.length,c=this.c,f=c&&this.d,h=function(){var t,e=pe(l,a);if(67324752==e){i=1,s=a,p.d=null,p.c=0;var r=he(l,a+6),o=he(l,a+8),f=2048&r,h=8&r,d=he(l,a+26),m=he(l,a+28);if(u>a+30+d+m){var v=[];p.k.unshift(v),i=2;var g,y=pe(l,a+18),w=pe(l,a+22),x=nn(l.subarray(a+30,a+=30+d),!f);4294967295==y?(t=h?[-2]:sn(l,a),y=t[0],w=t[1]):h&&(y=-1),a+=m,p.c=y;var b={name:x,compression:o,start:function(){if(!b.ondata)throw"no callback";if(y){var t=n.o[o];if(!t)throw"unknown compression type "+o;(g=y<0?new t(x):new t(x,y,w)).ondata=function(t,e,n){b.ondata(t,e,n)};for(var e=0,r=v;e<r.length;e++){var i=r[e];g.push(i,!1)}n.k[0]==v&&n.c?n.d=g:g.push(Wt,!0)}else b.ondata(null,Wt,!0)},terminate:function(){g&&g.terminate&&g.terminate()}};y>=0&&(b.size=y,b.originalSize=w),p.onfile(b)}return"break"}if(c){if(134695760==e)return s=a+=12+(-2==c&&8),i=3,p.c=0,"break";if(33639248==e)return s=a-=4,i=3,p.c=0,"break"}},p=this;a<u-4;++a){if("break"===h())break}if(this.p=Wt,c<0){var d=i?l.subarray(0,s-12-(-2==c&&8)-(134695760==pe(l,s-16)&&4)):l.subarray(0,a);f?f.push(d,!!i):this.k[+(2==i)].push(d)}if(2&i)return this.push(l.subarray(a),e);this.p=l.subarray(a)}if(e){if(this.c)throw"invalid zip file";this.p=null}},t.prototype.register=function(t){this.o[t.compression]=t},t}();var wn=Object.freeze(Object.defineProperty({__proto__:null,Deflate:Te,AsyncDeflate:Se,deflate:Ce,deflateSync:Pe,Inflate:Ae,AsyncInflate:ke,inflate:Me,inflateSync:De,Gzip:Ee,AsyncGzip:Fe,gzip:Le,gzipSync:ze,Gunzip:Oe,AsyncGunzip:Re,gunzip:Ne,gunzipSync:_e,Zlib:Be,AsyncZlib:Ue,zlib:function(t,e,n){if(n||(n=e,e={}),"function"!=typeof n)throw"no callback";return ue(t,e,[ne,ie,function(){return[je]}],(function(t){return se(je(t.data[0],t.data[1]))}),4,n)},zlibSync:je,Unzlib:Ge,AsyncUnzlib:Ve,unzlib:Xe,unzlibSync:We,compress:Le,AsyncCompress:Fe,compressSync:ze,Compress:Ee,Decompress:He,AsyncDecompress:Ye,decompress:function(t,e,n){if(n||(n=e,e={}),"function"!=typeof n)throw"no callback";return 31==t[0]&&139==t[1]&&8==t[2]?Ne(t,e,n):8!=(15&t[0])||t[0]>>4>7||(t[0]<<8|t[1])%31?Me(t,e,n):Xe(t,e,n)},decompressSync:function(t,e){return 31==t[0]&&139==t[1]&&8==t[2]?_e(t,e):8!=(15&t[0])||t[0]>>4>7||(t[0]<<8|t[1])%31?De(t,e):We(t,e)},DecodeUTF8:Je,EncodeUTF8:tn,strToU8:en,strFromU8:nn,ZipPassThrough:fn,ZipDeflate:hn,AsyncZipDeflate:pn,Zip:dn,zip:function(t,e,n){if(n||(n=e,e={}),"function"!=typeof n)throw"no callback";var r={};Ze(t,"",r,e);var o=Object.keys(r),i=o.length,a=0,s=0,l=i,u=new Array(i),c=[],f=function(){for(var t=0;t<c.length;++t)c[t]()},h=function(){var t=new st(s+22),e=a,r=s-a;s=0;for(var o=0;o<l;++o){var i=u[o];try{var c=i.c.length;un(t,s,i,i.f,i.u,c);var f=30+i.f.length+ln(i.extra),h=s+f;t.set(i.c,h),un(t,a,i,i.f,i.u,c,s,i.m),a+=16+f+(i.m?i.m.length:0),s=h+c}catch(ir){return n(ir,null)}}cn(t,a,u.length,r,e),n(null,t)};i||h();for(var p=function(t){var e=o[t],l=r[e],p=l[0],d=l[1],m=Zt(),v=p.length;m.p(p);var g=en(e),y=g.length,w=d.comment,x=w&&en(w),b=x&&x.length,I=ln(d.extra),T=0==d.level?0:8,S=function(r,o){if(r)f(),n(r,null);else{var l=o.length;u[t]=$t(d,{size:v,crc:m.d(),c:o,f:g,m:x,u:y!=e.length||x&&w.length!=b,compression:T}),a+=30+y+I+l,s+=76+2*(y+I)+(b||0)+l,--i||h()}};if(y>65535&&S("filename too long",null),T)if(v<16e4)try{S(null,Pe(p,d))}catch(ir){S(ir,null)}else c.push(Ce(p,d,S));else S(null,p)},d=0;d<l;++d)p(d);return f},zipSync:function(t,e){e||(e={});var n={},r=[];Ze(t,"",n,e);var o=0,i=0;for(var a in n){var s=n[a],l=s[0],u=s[1],c=0==u.level?0:8,f=(T=en(a)).length,h=u.comment,p=h&&en(h),d=p&&p.length,m=ln(u.extra);if(f>65535)throw"filename too long";var v=c?Pe(l,u):l,g=v.length,y=Zt();y.p(l),r.push($t(u,{size:l.length,crc:y.d(),c:v,f:T,m:p,u:f!=a.length||p&&h.length!=d,o:o,compression:c})),o+=30+f+m+g,i+=76+2*(f+m)+(d||0)+g}for(var w=new st(i+22),x=o,b=i-o,I=0;I<r.length;++I){var T=r[I];un(w,T.o,T,T.f,T.u,T.c.length);var S=30+T.f.length+ln(T.extra);w.set(T.c,T.o+S),un(w,o,T,T.f,T.u,T.c.length,T.o,T.m),o+=16+S+(T.m?T.m.length:0)}return cn(w,o,r.length,b,x),w},UnzipPassThrough:mn,UnzipInflate:vn,AsyncUnzipInflate:gn,Unzip:yn,unzip:function(t,e){if("function"!=typeof e)throw"no callback";for(var n=[],r=function(){for(var t=0;t<n.length;++t)n[t]()},o={},i=t.length-22;101010256!=pe(t,i);--i)if(!i||t.length-i>65558)return void e("invalid zip file",null);var a=he(t,i+8);a||e(null,{});var s=a,l=pe(t,i+16),u=4294967295==l;if(u){if(i=pe(t,i-12),101075792!=pe(t,i))return void e("invalid zip file",null);s=a=pe(t,i+32),l=pe(t,i+48)}for(var c=function(i){var s=an(t,l,u),c=s[0],f=s[1],h=s[2],p=s[3],d=s[4],m=s[5],v=on(t,m);l=d;var g=function(t,n){t?(r(),e(t,null)):(o[p]=n,--a||e(null,o))};if(c)if(8==c){var y=t.subarray(v,v+f);if(f<32e4)try{g(null,De(y,new st(h)))}catch(w){g(w,null)}else n.push(Me(y,{size:h},g))}else g("unknown compression type "+c,null);else g(null,zt(t,v,v+f))},f=0;f<s;++f)c();return r},unzipSync:function(t){for(var e={},n=t.length-22;101010256!=pe(t,n);--n)if(!n||t.length-n>65558)throw"invalid zip file";var r=he(t,n+8);if(!r)return{};var o=pe(t,n+16),i=4294967295==o;if(i){if(n=pe(t,n-12),101075792!=pe(t,n))throw"invalid zip file";r=pe(t,n+32),o=pe(t,n+48)}for(var a=0;a<r;++a){var s=an(t,o,i),l=s[0],u=s[1],c=s[2],f=s[3],h=s[4],p=s[5],d=on(t,p);if(o=h,l){if(8!=l)throw"unknown compression type "+l;e[f]=De(t.subarray(d,d+u),new st(c))}else e[f]=zt(t,d,d+u)}return e}},Symbol.toStringTag,{value:"Module"}));function xn(t,e,n){const r=n.length-t-1;if(e>=n[r])return r-1;if(e<=n[t])return t;let o=t,i=r,a=Math.floor((o+i)/2);for(;e<n[a]||e>=n[a+1];)e<n[a]?i=a:o=a,a=Math.floor((o+i)/2);return a}function bn(t,e){let n=1;for(let o=2;o<=t;++o)n*=o;let r=1;for(let o=2;o<=e;++o)r*=o;for(let o=2;o<=t-e;++o)r*=o;return n/r}function In(t,e,o,i,a){return function(t){const e=t.length,n=[],o=[];for(let a=0;a<e;++a){const e=t[a];n[a]=new r(e.x,e.y,e.z),o[a]=e.w}const i=[];for(let r=0;r<e;++r){const t=n[r].clone();for(let e=1;e<=r;++e)t.sub(i[r-e].clone().multiplyScalar(bn(r,e)*o[e]));i[r]=t.divideScalar(o[0])}return i}(function(t,e,r,o,i){const a=i<t?i:t,s=[],l=xn(t,o,e),u=function(t,e,n,r,o){const i=[];for(let f=0;f<=n;++f)i[f]=0;const a=[];for(let f=0;f<=r;++f)a[f]=i.slice(0);const s=[];for(let f=0;f<=n;++f)s[f]=i.slice(0);s[0][0]=1;const l=i.slice(0),u=i.slice(0);for(let f=1;f<=n;++f){l[f]=e-o[t+1-f],u[f]=o[t+f]-e;let n=0;for(let t=0;t<f;++t){const e=u[t+1],r=l[f-t];s[f][t]=e+r;const o=s[t][f-1]/s[f][t];s[t][f]=n+e*o,n=r*o}s[f][f]=n}for(let f=0;f<=n;++f)a[0][f]=s[f][n];for(let f=0;f<=n;++f){let t=0,e=1;const o=[];for(let r=0;r<=n;++r)o[r]=i.slice(0);o[0][0]=1;for(let i=1;i<=r;++i){let r=0;const l=f-i,u=n-i;f>=i&&(o[e][0]=o[t][0]/s[u+1][l],r=o[e][0]*s[l][u]);const c=f-1<=u?i-1:n-f;for(let n=l>=-1?1:-l;n<=c;++n)o[e][n]=(o[t][n]-o[t][n-1])/s[u+1][l+n],r+=o[e][n]*s[l+n][u];f<=u&&(o[e][i]=-o[t][i-1]/s[u+1][f],r+=o[e][i]*s[f][u]),a[i][f]=r;const h=t;t=e,e=h}}let c=n;for(let f=1;f<=r;++f){for(let t=0;t<=n;++t)a[f][t]*=c;c*=n-f}return a}(l,o,t,a,e),c=[];for(let n=0;n<r.length;++n){const t=r[n].clone(),e=t.w;t.x*=e,t.y*=e,t.z*=e,c[n]=t}for(let n=0;n<=a;++n){const e=c[l-t].clone().multiplyScalar(u[n][0]);for(let r=1;r<=t;++r)e.add(c[l-t+r].clone().multiplyScalar(u[n][r]));s[n]=e}for(let f=a+1;f<=i+1;++f)s[f]=new n(0,0,0);return s}(t,e,o,i,a))}class Tn extends o{constructor(t,e,r,o,i){super(),this.degree=t,this.knots=e,this.controlPoints=[],this.startKnot=o||0,this.endKnot=i||this.knots.length-1;for(let a=0;a<r.length;++a){const t=r[a];this.controlPoints[a]=new n(t.x,t.y,t.z,t.w)}}getPoint(t,e=new r){const o=e,i=this.knots[this.startKnot]+t*(this.knots[this.endKnot]-this.knots[this.startKnot]),a=function(t,e,r,o){const i=xn(t,o,e),a=function(t,e,n,r){const o=[],i=[],a=[];o[0]=1;for(let s=1;s<=n;++s){i[s]=e-r[t+1-s],a[s]=r[t+s]-e;let n=0;for(let t=0;t<s;++t){const e=a[t+1],r=i[s-t],l=o[t]/(e+r);o[t]=n+e*l,n=r*l}o[s]=n}return o}(i,o,t,e),s=new n(0,0,0,0);for(let n=0;n<=t;++n){const e=r[i-t+n],o=a[n],l=e.w*o;s.x+=e.x*l,s.y+=e.y*l,s.z+=e.z*l,s.w+=e.w*o}return s}(this.degree,this.knots,this.controlPoints,i);return 1!==a.w&&a.divideScalar(a.w),o.set(a.x,a.y,a.z)}getTangent(t,e=new r){const n=e,o=this.knots[0]+t*(this.knots[this.knots.length-1]-this.knots[0]),i=In(this.degree,this.knots,this.controlPoints,o,1);return n.copy(i[1]).normalize(),n}}let Sn,Cn,Pn;class An extends i{constructor(t){super(t)}load(t,e,n,r){const o=this,i=""===o.path?a.extractUrlBase(t):o.path,l=new s(this.manager);l.setPath(o.path),l.setResponseType("arraybuffer"),l.setRequestHeader(o.requestHeader),l.setWithCredentials(o.withCredentials),l.load(t,(function(n){try{e(o.parse(n,i))}catch(ir){r?r(ir):console.error(ir),o.manager.itemError(t)}}),n,r)}parse(t,e){if(function(t){const e="Kaydara FBX Binary  \0";return t.byteLength>=e.length&&e===Xn(t,0,e.length)}(t))Sn=(new Fn).parse(t);else{const e=Xn(t);if(!function(t){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let n=0;function r(e){const r=t[e-1];return t=t.slice(n+e),n++,r}for(let o=0;o<e.length;++o){if(r(1)===e[o])return!1}return!0}(e))throw new Error("THREE.FBXLoader: Unknown format.");if(On(e)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+On(e));Sn=(new En).parse(e)}const n=new l(this.manager).setPath(this.resourcePath||e).setCrossOrigin(this.crossOrigin);return new kn(n,this.manager).parse(Sn)}}class kn{constructor(t,e){this.textureLoader=t,this.manager=e}parse(){Cn=this.parseConnections();const t=this.parseImages(),e=this.parseTextures(t),n=this.parseMaterials(e),r=this.parseDeformers(),o=(new Mn).parse(r);return this.parseScene(r,o,n),Pn}parseConnections(){const t=new Map;if("Connections"in Sn){Sn.Connections.connections.forEach((function(e){const n=e[0],r=e[1],o=e[2];t.has(n)||t.set(n,{parents:[],children:[]});const i={ID:r,relationship:o};t.get(n).parents.push(i),t.has(r)||t.set(r,{parents:[],children:[]});const a={ID:n,relationship:o};t.get(r).children.push(a)}))}return t}parseImages(){const t={},e={};if("Video"in Sn.Objects){const n=Sn.Objects.Video;for(const r in n){const o=n[r];if(t[parseInt(r)]=o.RelativeFilename||o.Filename,"Content"in o){const t=o.Content instanceof ArrayBuffer&&o.Content.byteLength>0,i="string"==typeof o.Content&&""!==o.Content;if(t||i){const t=this.parseImage(n[r]);e[o.RelativeFilename||o.Filename]=t}}}}for(const n in t){const r=t[n];void 0!==e[r]?t[n]=e[r]:t[n]=t[n].split("\\").pop()}return t}parseImage(t){const e=t.Content,n=t.RelativeFilename||t.Filename,r=n.slice(n.lastIndexOf(".")+1).toLowerCase();let o;switch(r){case"bmp":o="image/bmp";break;case"jpg":case"jpeg":o="image/jpeg";break;case"png":o="image/png";break;case"tif":o="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",n),o="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+r+'" is not supported.')}if("string"==typeof e)return"data:"+o+";base64,"+e;{const t=new Uint8Array(e);return window.URL.createObjectURL(new Blob([t],{type:o}))}}parseTextures(t){const e=new Map;if("Texture"in Sn.Objects){const n=Sn.Objects.Texture;for(const r in n){const o=this.parseTexture(n[r],t);e.set(parseInt(r),o)}}return e}parseTexture(t,e){const n=this.loadTexture(t,e);n.ID=t.id,n.name=t.attrName;const r=t.WrapModeU,o=t.WrapModeV,i=void 0!==r?r.value:0,a=void 0!==o?o.value:0;if(n.wrapS=0===i?u:c,n.wrapT=0===a?u:c,"Scaling"in t){const e=t.Scaling.value;n.repeat.x=e[0],n.repeat.y=e[1]}return n}loadTexture(t,e){let n;const r=this.textureLoader.path,o=Cn.get(t.id).children;let i;void 0!==o&&o.length>0&&void 0!==e[o[0].ID]&&(n=e[o[0].ID],0!==n.indexOf("blob:")&&0!==n.indexOf("data:")||this.textureLoader.setPath(void 0));const a=t.FileName.slice(-3).toLowerCase();if("tga"===a){const e=this.manager.getHandler(".tga");null===e?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",t.RelativeFilename),i=new f):(e.setPath(this.textureLoader.path),i=e.load(n))}else"psd"===a?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",t.RelativeFilename),i=new f):i=this.textureLoader.load(n);return this.textureLoader.setPath(r),i}parseMaterials(t){const e=new Map;if("Material"in Sn.Objects){const n=Sn.Objects.Material;for(const r in n){const o=this.parseMaterial(n[r],t);null!==o&&e.set(parseInt(r),o)}}return e}parseMaterial(t,e){const n=t.id,r=t.attrName;let o=t.ShadingModel;if("object"==typeof o&&(o=o.value),!Cn.has(n))return null;const i=this.parseParameters(t,e,n);let a;switch(o.toLowerCase()){case"phong":a=new h;break;case"lambert":a=new p;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',o),a=new h}return a.setValues(i),a.name=r,a}parseParameters(t,e,n){const r={};t.BumpFactor&&(r.bumpScale=t.BumpFactor.value),t.Diffuse?r.color=(new d).fromArray(t.Diffuse.value):!t.DiffuseColor||"Color"!==t.DiffuseColor.type&&"ColorRGB"!==t.DiffuseColor.type||(r.color=(new d).fromArray(t.DiffuseColor.value)),t.DisplacementFactor&&(r.displacementScale=t.DisplacementFactor.value),t.Emissive?r.emissive=(new d).fromArray(t.Emissive.value):!t.EmissiveColor||"Color"!==t.EmissiveColor.type&&"ColorRGB"!==t.EmissiveColor.type||(r.emissive=(new d).fromArray(t.EmissiveColor.value)),t.EmissiveFactor&&(r.emissiveIntensity=parseFloat(t.EmissiveFactor.value)),t.Opacity&&(r.opacity=parseFloat(t.Opacity.value)),r.opacity<1&&(r.transparent=!0),t.ReflectionFactor&&(r.reflectivity=t.ReflectionFactor.value),t.Shininess&&(r.shininess=t.Shininess.value),t.Specular?r.specular=(new d).fromArray(t.Specular.value):t.SpecularColor&&"Color"===t.SpecularColor.type&&(r.specular=(new d).fromArray(t.SpecularColor.value));const o=this;return Cn.get(n).children.forEach((function(t){const n=t.relationship;switch(n){case"Bump":r.bumpMap=o.getTexture(e,t.ID);break;case"Maya|TEX_ao_map":r.aoMap=o.getTexture(e,t.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":r.map=o.getTexture(e,t.ID),void 0!==r.map&&(r.map.encoding=m);break;case"DisplacementColor":r.displacementMap=o.getTexture(e,t.ID);break;case"EmissiveColor":r.emissiveMap=o.getTexture(e,t.ID),void 0!==r.emissiveMap&&(r.emissiveMap.encoding=m);break;case"NormalMap":case"Maya|TEX_normal_map":r.normalMap=o.getTexture(e,t.ID);break;case"ReflectionColor":r.envMap=o.getTexture(e,t.ID),void 0!==r.envMap&&(r.envMap.mapping=v,r.envMap.encoding=m);break;case"SpecularColor":r.specularMap=o.getTexture(e,t.ID),void 0!==r.specularMap&&(r.specularMap.encoding=m);break;case"TransparentColor":case"TransparencyFactor":r.alphaMap=o.getTexture(e,t.ID),r.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",n)}})),r}getTexture(t,e){return"LayeredTexture"in Sn.Objects&&e in Sn.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),e=Cn.get(e).children[0].ID),t.get(e)}parseDeformers(){const t={},e={};if("Deformer"in Sn.Objects){const n=Sn.Objects.Deformer;for(const r in n){const o=n[r],i=Cn.get(parseInt(r));if("Skin"===o.attrType){const e=this.parseSkeleton(i,n);e.ID=r,i.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),e.geometryID=i.parents[0].ID,t[r]=e}else if("BlendShape"===o.attrType){const t={id:r};t.rawTargets=this.parseMorphTargets(i,n),t.id=r,i.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),e[r]=t}}}return{skeletons:t,morphTargets:e}}parseSkeleton(t,e){const n=[];return t.children.forEach((function(t){const r=e[t.ID];if("Cluster"!==r.attrType)return;const o={ID:t.ID,indices:[],weights:[],transformLink:(new g).fromArray(r.TransformLink.a)};"Indexes"in r&&(o.indices=r.Indexes.a,o.weights=r.Weights.a),n.push(o)})),{rawBones:n,bones:[]}}parseMorphTargets(t,e){const n=[];for(let r=0;r<t.children.length;r++){const o=t.children[r],i=e[o.ID],a={name:i.attrName,initialWeight:i.DeformPercent,id:i.id,fullWeights:i.FullWeights.a};if("BlendShapeChannel"!==i.attrType)return;a.geoID=Cn.get(parseInt(o.ID)).children.filter((function(t){return void 0===t.relationship}))[0].ID,n.push(a)}return n}parseScene(t,e,n){Pn=new y;const r=this.parseModels(t.skeletons,e,n),o=Sn.Objects.Model,i=this;r.forEach((function(t){const e=o[t.ID];i.setLookAtProperties(t,e);Cn.get(t.ID).parents.forEach((function(e){const n=r.get(e.ID);void 0!==n&&n.add(t)})),null===t.parent&&Pn.add(t)})),this.bindSkeleton(t.skeletons,e,r),this.createAmbientLight(),Pn.traverse((function(t){if(t.userData.transformData){t.parent&&(t.userData.transformData.parentMatrix=t.parent.matrix,t.userData.transformData.parentMatrixWorld=t.parent.matrixWorld);const e=jn(t.userData.transformData);t.applyMatrix4(e),t.updateWorldMatrix()}}));const a=(new Dn).parse();1===Pn.children.length&&Pn.children[0].isGroup&&(Pn.children[0].animations=a,Pn=Pn.children[0]),Pn.animations=a}parseModels(t,e,n){const r=new Map,o=Sn.Objects.Model;for(const i in o){const a=parseInt(i),s=o[i],l=Cn.get(a);let u=this.buildSkeleton(l,t,a,s.attrName);if(!u){switch(s.attrType){case"Camera":u=this.createCamera(l);break;case"Light":u=this.createLight(l);break;case"Mesh":u=this.createMesh(l,e,n);break;case"NurbsCurve":u=this.createCurve(l,e);break;case"LimbNode":case"Root":u=new w;break;case"Null":default:u=new y}u.name=s.attrName?x.sanitizeNodeName(s.attrName):"",u.ID=a}this.getTransformData(u,s),r.set(a,u)}return r}buildSkeleton(t,e,n,r){let o=null;return t.parents.forEach((function(t){for(const i in e){const a=e[i];a.rawBones.forEach((function(e,i){if(e.ID===t.ID){const t=o;o=new w,o.matrixWorld.copy(e.transformLink),o.name=r?x.sanitizeNodeName(r):"",o.ID=n,a.bones[i]=o,null!==t&&o.add(t)}}))}})),o}createCamera(t){let e,n;if(t.children.forEach((function(t){const e=Sn.Objects.NodeAttribute[t.ID];void 0!==e&&(n=e)})),void 0===n)e=new b;else{let t=0;void 0!==n.CameraProjectionType&&1===n.CameraProjectionType.value&&(t=1);let r=1;void 0!==n.NearPlane&&(r=n.NearPlane.value/1e3);let o=1e3;void 0!==n.FarPlane&&(o=n.FarPlane.value/1e3);let i=window.innerWidth,a=window.innerHeight;void 0!==n.AspectWidth&&void 0!==n.AspectHeight&&(i=n.AspectWidth.value,a=n.AspectHeight.value);const s=i/a;let l=45;void 0!==n.FieldOfView&&(l=n.FieldOfView.value);const u=n.FocalLength?n.FocalLength.value:null;switch(t){case 0:e=new T(l,s,r,o),null!==u&&e.setFocalLength(u);break;case 1:e=new I(-i/2,i/2,a/2,-a/2,r,o);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+t+"."),e=new b}}return e}createLight(t){let e,n;if(t.children.forEach((function(t){const e=Sn.Objects.NodeAttribute[t.ID];void 0!==e&&(n=e)})),void 0===n)e=new b;else{let t;t=void 0===n.LightType?0:n.LightType.value;let r=16777215;void 0!==n.Color&&(r=(new d).fromArray(n.Color.value));let o=void 0===n.Intensity?1:n.Intensity.value/100;void 0!==n.CastLightOnObject&&0===n.CastLightOnObject.value&&(o=0);let i=0;void 0!==n.FarAttenuationEnd&&(i=void 0!==n.EnableFarAttenuation&&0===n.EnableFarAttenuation.value?0:n.FarAttenuationEnd.value);const a=1;switch(t){case 0:e=new S(r,o,i,a);break;case 1:e=new A(r,o);break;case 2:let t=Math.PI/3;void 0!==n.InnerAngle&&(t=C.degToRad(n.InnerAngle.value));let s=0;void 0!==n.OuterAngle&&(s=C.degToRad(n.OuterAngle.value),s=Math.max(s,1)),e=new P(r,o,i,t,s,a);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),e=new S(r,o)}void 0!==n.CastShadows&&1===n.CastShadows.value&&(e.castShadow=!0)}return e}createMesh(t,e,n){let r,o=null,i=null;const a=[];return t.children.forEach((function(t){e.has(t.ID)&&(o=e.get(t.ID)),n.has(t.ID)&&a.push(n.get(t.ID))})),a.length>1?i=a:a.length>0?i=a[0]:(i=new h({color:13421772}),a.push(i)),"color"in o.attributes&&a.forEach((function(t){t.vertexColors=!0})),o.FBX_Deformer?(r=new k(o,i),r.normalizeSkinWeights()):r=new M(o,i),r}createCurve(t,e){const n=t.children.reduce((function(t,n){return e.has(n.ID)&&(t=e.get(n.ID)),t}),null),r=new D({color:3342591,linewidth:1});return new E(n,r)}getTransformData(t,e){const n={};"InheritType"in e&&(n.inheritType=parseInt(e.InheritType.value)),n.eulerOrder="RotationOrder"in e?Gn(e.RotationOrder.value):"ZYX","Lcl_Translation"in e&&(n.translation=e.Lcl_Translation.value),"PreRotation"in e&&(n.preRotation=e.PreRotation.value),"Lcl_Rotation"in e&&(n.rotation=e.Lcl_Rotation.value),"PostRotation"in e&&(n.postRotation=e.PostRotation.value),"Lcl_Scaling"in e&&(n.scale=e.Lcl_Scaling.value),"ScalingOffset"in e&&(n.scalingOffset=e.ScalingOffset.value),"ScalingPivot"in e&&(n.scalingPivot=e.ScalingPivot.value),"RotationOffset"in e&&(n.rotationOffset=e.RotationOffset.value),"RotationPivot"in e&&(n.rotationPivot=e.RotationPivot.value),t.userData.transformData=n}setLookAtProperties(t,e){if("LookAtProperty"in e){Cn.get(t.ID).children.forEach((function(e){if("LookAtProperty"===e.relationship){const n=Sn.Objects.Model[e.ID];if("Lcl_Translation"in n){const e=n.Lcl_Translation.value;void 0!==t.target?(t.target.position.fromArray(e),Pn.add(t.target)):t.lookAt((new r).fromArray(e))}}}))}}bindSkeleton(t,e,n){const r=this.parsePoseNodes();for(const o in t){const i=t[o];Cn.get(parseInt(i.ID)).parents.forEach((function(t){if(e.has(t.ID)){const e=t.ID;Cn.get(e).parents.forEach((function(t){if(n.has(t.ID)){n.get(t.ID).bind(new F(i.bones),r[t.ID])}}))}}))}}parsePoseNodes(){const t={};if("Pose"in Sn.Objects){const e=Sn.Objects.Pose;for(const n in e)if("BindPose"===e[n].attrType&&e[n].NbPoseNodes>0){const r=e[n].PoseNode;Array.isArray(r)?r.forEach((function(e){t[e.Node]=(new g).fromArray(e.Matrix.a)})):t[r.Node]=(new g).fromArray(r.Matrix.a)}}return t}createAmbientLight(){if("GlobalSettings"in Sn&&"AmbientColor"in Sn.GlobalSettings){const t=Sn.GlobalSettings.AmbientColor.value,e=t[0],n=t[1],r=t[2];if(0!==e||0!==n||0!==r){const t=new d(e,n,r);Pn.add(new L(t,1))}}}}class Mn{parse(t){const e=new Map;if("Geometry"in Sn.Objects){const n=Sn.Objects.Geometry;for(const r in n){const o=Cn.get(parseInt(r)),i=this.parseGeometry(o,n[r],t);e.set(parseInt(r),i)}}return e}parseGeometry(t,e,n){switch(e.attrType){case"Mesh":return this.parseMeshGeometry(t,e,n);case"NurbsCurve":return this.parseNurbsGeometry(e)}}parseMeshGeometry(t,e,n){const r=n.skeletons,o=[],i=t.parents.map((function(t){return Sn.Objects.Model[t.ID]}));if(0===i.length)return;const a=t.children.reduce((function(t,e){return void 0!==r[e.ID]&&(t=r[e.ID]),t}),null);t.children.forEach((function(t){void 0!==n.morphTargets[t.ID]&&o.push(n.morphTargets[t.ID])}));const s=i[0],l={};"RotationOrder"in s&&(l.eulerOrder=Gn(s.RotationOrder.value)),"InheritType"in s&&(l.inheritType=parseInt(s.InheritType.value)),"GeometricTranslation"in s&&(l.translation=s.GeometricTranslation.value),"GeometricRotation"in s&&(l.rotation=s.GeometricRotation.value),"GeometricScaling"in s&&(l.scale=s.GeometricScaling.value);const u=jn(l);return this.genGeometry(e,a,o,u)}genGeometry(t,e,n,r){const o=new z;t.attrName&&(o.name=t.attrName);const i=this.parseGeoNode(t,e),a=this.genBuffers(i),s=new O(a.vertex,3);if(s.applyMatrix4(r),o.setAttribute("position",s),a.colors.length>0&&o.setAttribute("color",new O(a.colors,3)),e&&(o.setAttribute("skinIndex",new R(a.weightsIndices,4)),o.setAttribute("skinWeight",new O(a.vertexWeights,4)),o.FBX_Deformer=e),a.normal.length>0){const t=(new N).getNormalMatrix(r),e=new O(a.normal,3);e.applyNormalMatrix(t),o.setAttribute("normal",e)}if(a.uvs.forEach((function(t,e){let n="uv"+(e+1).toString();0===e&&(n="uv"),o.setAttribute(n,new O(a.uvs[e],2))})),i.material&&"AllSame"!==i.material.mappingType){let t=a.materialIndex[0],e=0;if(a.materialIndex.forEach((function(n,r){n!==t&&(o.addGroup(e,r-e,t),t=n,e=r)})),o.groups.length>0){const e=o.groups[o.groups.length-1],n=e.start+e.count;n!==a.materialIndex.length&&o.addGroup(n,a.materialIndex.length-n,t)}0===o.groups.length&&o.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(o,t,n,r),o}parseGeoNode(t,e){const n={};if(n.vertexPositions=void 0!==t.Vertices?t.Vertices.a:[],n.vertexIndices=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],t.LayerElementColor&&(n.color=this.parseVertexColors(t.LayerElementColor[0])),t.LayerElementMaterial&&(n.material=this.parseMaterialIndices(t.LayerElementMaterial[0])),t.LayerElementNormal&&(n.normal=this.parseNormals(t.LayerElementNormal[0])),t.LayerElementUV){n.uv=[];let e=0;for(;t.LayerElementUV[e];)t.LayerElementUV[e].UV&&n.uv.push(this.parseUVs(t.LayerElementUV[e])),e++}return n.weightTable={},null!==e&&(n.skeleton=e,e.rawBones.forEach((function(t,e){t.indices.forEach((function(r,o){void 0===n.weightTable[r]&&(n.weightTable[r]=[]),n.weightTable[r].push({id:e,weight:t.weights[o]})}))}))),n}genBuffers(t){const e={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,r=0,o=!1,i=[],a=[],s=[],l=[],u=[],c=[];const f=this;return t.vertexIndices.forEach((function(h,p){let d,m=!1;h<0&&(h^=-1,m=!0);let v=[],g=[];if(i.push(3*h,3*h+1,3*h+2),t.color){const e=_n(p,n,h,t.color);s.push(e[0],e[1],e[2])}if(t.skeleton){if(void 0!==t.weightTable[h]&&t.weightTable[h].forEach((function(t){g.push(t.weight),v.push(t.id)})),g.length>4){o||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),o=!0);const t=[0,0,0,0],e=[0,0,0,0];g.forEach((function(n,r){let o=n,i=v[r];e.forEach((function(e,n,r){if(o>e){r[n]=o,o=e;const a=t[n];t[n]=i,i=a}}))})),v=t,g=e}for(;g.length<4;)g.push(0),v.push(0);for(let t=0;t<4;++t)u.push(g[t]),c.push(v[t])}if(t.normal){const e=_n(p,n,h,t.normal);a.push(e[0],e[1],e[2])}t.material&&"AllSame"!==t.material.mappingType&&(d=_n(p,n,h,t.material)[0]),t.uv&&t.uv.forEach((function(t,e){const r=_n(p,n,h,t);void 0===l[e]&&(l[e]=[]),l[e].push(r[0]),l[e].push(r[1])})),r++,m&&(f.genFace(e,t,i,d,a,s,l,u,c,r),n++,r=0,i=[],a=[],s=[],l=[],u=[],c=[])})),e}genFace(t,e,n,r,o,i,a,s,l,u){for(let c=2;c<u;c++)t.vertex.push(e.vertexPositions[n[0]]),t.vertex.push(e.vertexPositions[n[1]]),t.vertex.push(e.vertexPositions[n[2]]),t.vertex.push(e.vertexPositions[n[3*(c-1)]]),t.vertex.push(e.vertexPositions[n[3*(c-1)+1]]),t.vertex.push(e.vertexPositions[n[3*(c-1)+2]]),t.vertex.push(e.vertexPositions[n[3*c]]),t.vertex.push(e.vertexPositions[n[3*c+1]]),t.vertex.push(e.vertexPositions[n[3*c+2]]),e.skeleton&&(t.vertexWeights.push(s[0]),t.vertexWeights.push(s[1]),t.vertexWeights.push(s[2]),t.vertexWeights.push(s[3]),t.vertexWeights.push(s[4*(c-1)]),t.vertexWeights.push(s[4*(c-1)+1]),t.vertexWeights.push(s[4*(c-1)+2]),t.vertexWeights.push(s[4*(c-1)+3]),t.vertexWeights.push(s[4*c]),t.vertexWeights.push(s[4*c+1]),t.vertexWeights.push(s[4*c+2]),t.vertexWeights.push(s[4*c+3]),t.weightsIndices.push(l[0]),t.weightsIndices.push(l[1]),t.weightsIndices.push(l[2]),t.weightsIndices.push(l[3]),t.weightsIndices.push(l[4*(c-1)]),t.weightsIndices.push(l[4*(c-1)+1]),t.weightsIndices.push(l[4*(c-1)+2]),t.weightsIndices.push(l[4*(c-1)+3]),t.weightsIndices.push(l[4*c]),t.weightsIndices.push(l[4*c+1]),t.weightsIndices.push(l[4*c+2]),t.weightsIndices.push(l[4*c+3])),e.color&&(t.colors.push(i[0]),t.colors.push(i[1]),t.colors.push(i[2]),t.colors.push(i[3*(c-1)]),t.colors.push(i[3*(c-1)+1]),t.colors.push(i[3*(c-1)+2]),t.colors.push(i[3*c]),t.colors.push(i[3*c+1]),t.colors.push(i[3*c+2])),e.material&&"AllSame"!==e.material.mappingType&&(t.materialIndex.push(r),t.materialIndex.push(r),t.materialIndex.push(r)),e.normal&&(t.normal.push(o[0]),t.normal.push(o[1]),t.normal.push(o[2]),t.normal.push(o[3*(c-1)]),t.normal.push(o[3*(c-1)+1]),t.normal.push(o[3*(c-1)+2]),t.normal.push(o[3*c]),t.normal.push(o[3*c+1]),t.normal.push(o[3*c+2])),e.uv&&e.uv.forEach((function(e,n){void 0===t.uvs[n]&&(t.uvs[n]=[]),t.uvs[n].push(a[n][0]),t.uvs[n].push(a[n][1]),t.uvs[n].push(a[n][2*(c-1)]),t.uvs[n].push(a[n][2*(c-1)+1]),t.uvs[n].push(a[n][2*c]),t.uvs[n].push(a[n][2*c+1])}))}addMorphTargets(t,e,n,r){if(0===n.length)return;t.morphTargetsRelative=!0,t.morphAttributes.position=[];const o=this;n.forEach((function(n){n.rawTargets.forEach((function(n){const i=Sn.Objects.Geometry[n.geoID];void 0!==i&&o.genMorphGeometry(t,e,i,r,n.name)}))}))}genMorphGeometry(t,e,n,r,o){const i=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],a=void 0!==n.Vertices?n.Vertices.a:[],s=void 0!==n.Indexes?n.Indexes.a:[],l=3*t.attributes.position.count,u=new Float32Array(l);for(let p=0;p<s.length;p++){const t=3*s[p];u[t]=a[3*p],u[t+1]=a[3*p+1],u[t+2]=a[3*p+2]}const c={vertexIndices:i,vertexPositions:u},f=this.genBuffers(c),h=new O(f.vertex,3);h.name=o||n.attrName,h.applyMatrix4(r),t.morphAttributes.position.push(h)}parseNormals(t){const e=t.MappingInformationType,n=t.ReferenceInformationType,r=t.Normals.a;let o=[];return"IndexToDirect"===n&&("NormalIndex"in t?o=t.NormalIndex.a:"NormalsIndex"in t&&(o=t.NormalsIndex.a)),{dataSize:3,buffer:r,indices:o,mappingType:e,referenceType:n}}parseUVs(t){const e=t.MappingInformationType,n=t.ReferenceInformationType,r=t.UV.a;let o=[];return"IndexToDirect"===n&&(o=t.UVIndex.a),{dataSize:2,buffer:r,indices:o,mappingType:e,referenceType:n}}parseVertexColors(t){const e=t.MappingInformationType,n=t.ReferenceInformationType,r=t.Colors.a;let o=[];return"IndexToDirect"===n&&(o=t.ColorIndex.a),{dataSize:4,buffer:r,indices:o,mappingType:e,referenceType:n}}parseMaterialIndices(t){const e=t.MappingInformationType,n=t.ReferenceInformationType;if("NoMappingInformation"===e)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const r=t.Materials.a,o=[];for(let i=0;i<r.length;++i)o.push(i);return{dataSize:1,buffer:r,indices:o,mappingType:e,referenceType:n}}parseNurbsGeometry(t){if(void 0===Tn)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new z;const e=parseInt(t.Order);if(isNaN(e))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",t.Order,t.id),new z;const r=e-1,o=t.KnotVector.a,i=[],a=t.Points.a;for(let c=0,f=a.length;c<f;c+=4)i.push((new n).fromArray(a,c));let s,l;if("Closed"===t.Form)i.push(i[0]);else if("Periodic"===t.Form){s=r,l=o.length-1-s;for(let t=0;t<r;++t)i.push(i[t])}const u=new Tn(r,o,i,s,l).getPoints(12*i.length);return(new z).setFromPoints(u)}}class Dn{parse(){const t=[],e=this.parseClips();if(void 0!==e)for(const n in e){const r=e[n],o=this.addClip(r);t.push(o)}return t}parseClips(){if(void 0===Sn.Objects.AnimationCurve)return;const t=this.parseAnimationCurveNodes();this.parseAnimationCurves(t);const e=this.parseAnimationLayers(t);return this.parseAnimStacks(e)}parseAnimationCurveNodes(){const t=Sn.Objects.AnimationCurveNode,e=new Map;for(const n in t){const r=t[n];if(null!==r.attrName.match(/S|R|T|DeformPercent/)){const t={id:r.id,attr:r.attrName,curves:{}};e.set(t.id,t)}}return e}parseAnimationCurves(t){const e=Sn.Objects.AnimationCurve;for(const n in e){const r={id:e[n].id,times:e[n].KeyTime.a.map(Rn),values:e[n].KeyValueFloat.a},o=Cn.get(r.id);if(void 0!==o){const e=o.parents[0].ID,n=o.parents[0].relationship;n.match(/X/)?t.get(e).curves.x=r:n.match(/Y/)?t.get(e).curves.y=r:n.match(/Z/)?t.get(e).curves.z=r:n.match(/d|DeformPercent/)&&t.has(e)&&(t.get(e).curves.morph=r)}}}parseAnimationLayers(t){const e=Sn.Objects.AnimationLayer,n=new Map;for(const r in e){const e=[],o=Cn.get(parseInt(r));if(void 0!==o){o.children.forEach((function(n,r){if(t.has(n.ID)){const o=t.get(n.ID);if(void 0!==o.curves.x||void 0!==o.curves.y||void 0!==o.curves.z){if(void 0===e[r]){const t=Cn.get(n.ID).parents.filter((function(t){return void 0!==t.relationship}))[0].ID;if(void 0!==t){const o=Sn.Objects.Model[t.toString()];if(void 0===o)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",n);const i={modelName:o.attrName?x.sanitizeNodeName(o.attrName):"",ID:o.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Pn.traverse((function(t){t.ID===o.id&&(i.transform=t.matrix,t.userData.transformData&&(i.eulerOrder=t.userData.transformData.eulerOrder))})),i.transform||(i.transform=new g),"PreRotation"in o&&(i.preRotation=o.PreRotation.value),"PostRotation"in o&&(i.postRotation=o.PostRotation.value),e[r]=i}}e[r]&&(e[r][o.attr]=o)}else if(void 0!==o.curves.morph){if(void 0===e[r]){const t=Cn.get(n.ID).parents.filter((function(t){return void 0!==t.relationship}))[0].ID,o=Cn.get(t).parents[0].ID,i=Cn.get(o).parents[0].ID,a=Cn.get(i).parents[0].ID,s=Sn.Objects.Model[a],l={modelName:s.attrName?x.sanitizeNodeName(s.attrName):"",morphName:Sn.Objects.Deformer[t].attrName};e[r]=l}e[r][o.attr]=o}}})),n.set(parseInt(r),e)}}return n}parseAnimStacks(t){const e=Sn.Objects.AnimationStack,n={};for(const r in e){const o=Cn.get(parseInt(r)).children;o.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const i=t.get(o[0].ID);n[r]={name:e[r].attrName,layer:i}}return n}addClip(t){let e=[];const n=this;return t.layer.forEach((function(t){e=e.concat(n.generateTracks(t))})),new _(t.name,-1,e)}generateTracks(t){const e=[];let n=new r,o=new B,i=new r;if(t.transform&&t.transform.decompose(n,o,i),n=n.toArray(),o=(new U).setFromQuaternion(o,t.eulerOrder).toArray(),i=i.toArray(),void 0!==t.T&&Object.keys(t.T.curves).length>0){const r=this.generateVectorTrack(t.modelName,t.T.curves,n,"position");void 0!==r&&e.push(r)}if(void 0!==t.R&&Object.keys(t.R.curves).length>0){const n=this.generateRotationTrack(t.modelName,t.R.curves,o,t.preRotation,t.postRotation,t.eulerOrder);void 0!==n&&e.push(n)}if(void 0!==t.S&&Object.keys(t.S.curves).length>0){const n=this.generateVectorTrack(t.modelName,t.S.curves,i,"scale");void 0!==n&&e.push(n)}if(void 0!==t.DeformPercent){const n=this.generateMorphTrack(t);void 0!==n&&e.push(n)}return e}generateVectorTrack(t,e,n,r){const o=this.getTimesForAllAxes(e),i=this.getKeyframeTrackValues(o,e,n);return new j(t+"."+r,o,i)}generateRotationTrack(t,e,n,r,o,i){void 0!==e.x&&(this.interpolateRotations(e.x),e.x.values=e.x.values.map(C.degToRad)),void 0!==e.y&&(this.interpolateRotations(e.y),e.y.values=e.y.values.map(C.degToRad)),void 0!==e.z&&(this.interpolateRotations(e.z),e.z.values=e.z.values.map(C.degToRad));const a=this.getTimesForAllAxes(e),s=this.getKeyframeTrackValues(a,e,n);void 0!==r&&((r=r.map(C.degToRad)).push(i),r=(new U).fromArray(r),r=(new B).setFromEuler(r)),void 0!==o&&((o=o.map(C.degToRad)).push(i),o=(new U).fromArray(o),o=(new B).setFromEuler(o).invert());const l=new B,u=new U,c=[];for(let f=0;f<s.length;f+=3)u.set(s[f],s[f+1],s[f+2],i),l.setFromEuler(u),void 0!==r&&l.premultiply(r),void 0!==o&&l.multiply(o),l.toArray(c,f/3*4);return new G(t+".quaternion",a,c)}generateMorphTrack(t){const e=t.DeformPercent.curves.morph,n=e.values.map((function(t){return t/100})),r=Pn.getObjectByName(t.modelName).morphTargetDictionary[t.morphName];return new V(t.modelName+".morphTargetInfluences["+r+"]",e.times,n)}getTimesForAllAxes(t){let e=[];if(void 0!==t.x&&(e=e.concat(t.x.times)),void 0!==t.y&&(e=e.concat(t.y.times)),void 0!==t.z&&(e=e.concat(t.z.times)),e=e.sort((function(t,e){return t-e})),e.length>1){let t=1,n=e[0];for(let r=1;r<e.length;r++){const o=e[r];o!==n&&(e[t]=o,n=o,t++)}e=e.slice(0,t)}return e}getKeyframeTrackValues(t,e,n){const r=n,o=[];let i=-1,a=-1,s=-1;return t.forEach((function(t){if(e.x&&(i=e.x.times.indexOf(t)),e.y&&(a=e.y.times.indexOf(t)),e.z&&(s=e.z.times.indexOf(t)),-1!==i){const t=e.x.values[i];o.push(t),r[0]=t}else o.push(r[0]);if(-1!==a){const t=e.y.values[a];o.push(t),r[1]=t}else o.push(r[1]);if(-1!==s){const t=e.z.values[s];o.push(t),r[2]=t}else o.push(r[2])})),o}interpolateRotations(t){for(let e=1;e<t.values.length;e++){const n=t.values[e-1],r=t.values[e]-n,o=Math.abs(r);if(o>=180){const i=o/180,a=r/i;let s=n+a;const l=t.times[e-1],u=(t.times[e]-l)/i;let c=l+u;const f=[],h=[];for(;c<t.times[e];)f.push(c),c+=u,h.push(s),s+=a;t.times=Wn(t.times,e,f),t.values=Wn(t.values,e,h)}}}}class En{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(t){this.nodeStack.push(t),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(t,e){this.currentProp=t,this.currentPropName=e}parse(t){this.currentIndent=0,this.allNodes=new zn,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const e=this,n=t.split(/[\r\n]+/);return n.forEach((function(t,r){const o=t.match(/^[\s\t]*;/),i=t.match(/^[\s\t]*$/);if(o||i)return;const a=t.match("^\\t{"+e.currentIndent+"}(\\w+):(.*){",""),s=t.match("^\\t{"+e.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=t.match("^\\t{"+(e.currentIndent-1)+"}}");a?e.parseNodeBegin(t,a):s?e.parseNodeProperty(t,s,n[++r]):l?e.popStack():t.match(/^[^\s\t}]/)&&e.parseNodePropertyContinued(t)})),this.allNodes}parseNodeBegin(t,e){const n=e[1].trim().replace(/^"/,"").replace(/"$/,""),r=e[2].split(",").map((function(t){return t.trim().replace(/^"/,"").replace(/"$/,"")})),o={name:n},i=this.parseNodeAttr(r),a=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(n,o):n in a?("PoseNode"===n?a.PoseNode.push(o):void 0!==a[n].id&&(a[n]={},a[n][a[n].id]=a[n]),""!==i.id&&(a[n][i.id]=o)):"number"==typeof i.id?(a[n]={},a[n][i.id]=o):"Properties70"!==n&&(a[n]="PoseNode"===n?[o]:o),"number"==typeof i.id&&(o.id=i.id),""!==i.name&&(o.attrName=i.name),""!==i.type&&(o.attrType=i.type),this.pushStack(o)}parseNodeAttr(t){let e=t[0];""!==t[0]&&(e=parseInt(t[0]),isNaN(e)&&(e=t[0]));let n="",r="";return t.length>1&&(n=t[1].replace(/^(\w+)::/,""),r=t[2]),{id:e,name:n,type:r}}parseNodeProperty(t,e,n){let r=e[1].replace(/^"/,"").replace(/"$/,"").trim(),o=e[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===r&&","===o&&(o=n.replace(/"/g,"").replace(/,$/,"").trim());const i=this.getCurrentNode();if("Properties70"!==i.name){if("C"===r){const t=o.split(",").slice(1),e=parseInt(t[0]),n=parseInt(t[1]);let a=o.split(",").slice(3);a=a.map((function(t){return t.trim().replace(/^"/,"")})),r="connections",o=[e,n],function(t,e){for(let n=0,r=t.length,o=e.length;n<o;n++,r++)t[r]=e[n]}(o,a),void 0===i[r]&&(i[r]=[])}"Node"===r&&(i.id=o),r in i&&Array.isArray(i[r])?i[r].push(o):"a"!==r?i[r]=o:i.a=o,this.setCurrentProp(i,r),"a"===r&&","!==o.slice(-1)&&(i.a=Vn(o))}else this.parseNodeSpecialProperty(t,r,o)}parseNodePropertyContinued(t){const e=this.getCurrentNode();e.a+=t,","!==t.slice(-1)&&(e.a=Vn(e.a))}parseNodeSpecialProperty(t,e,n){const r=n.split('",').map((function(t){return t.trim().replace(/^\"/,"").replace(/\s/,"_")})),o=r[0],i=r[1],a=r[2],s=r[3];let l=r[4];switch(i){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=Vn(l)}this.getPrevNode()[o]={type:i,type2:a,flag:s,value:l},this.setCurrentProp(this.getPrevNode(),o)}}class Fn{parse(t){const e=new Ln(t);e.skip(23);const n=e.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const r=new zn;for(;!this.endOfContent(e);){const t=this.parseNode(e,n);null!==t&&r.add(t.name,t)}return r}endOfContent(t){return t.size()%16==0?(t.getOffset()+160+16&-16)>=t.size():t.getOffset()+160+16>=t.size()}parseNode(t,e){const n={},r=e>=7500?t.getUint64():t.getUint32(),o=e>=7500?t.getUint64():t.getUint32();e>=7500?t.getUint64():t.getUint32();const i=t.getUint8(),a=t.getString(i);if(0===r)return null;const s=[];for(let f=0;f<o;f++)s.push(this.parseProperty(t));const l=s.length>0?s[0]:"",u=s.length>1?s[1]:"",c=s.length>2?s[2]:"";for(n.singleProperty=1===o&&t.getOffset()===r;r>t.getOffset();){const r=this.parseNode(t,e);null!==r&&this.parseSubNode(a,n,r)}return n.propertyList=s,"number"==typeof l&&(n.id=l),""!==u&&(n.attrName=u),""!==c&&(n.attrType=c),""!==a&&(n.name=a),n}parseSubNode(t,e,n){if(!0===n.singleProperty){const t=n.propertyList[0];Array.isArray(t)?(e[n.name]=n,n.a=t):e[n.name]=t}else if("Connections"===t&&"C"===n.name){const t=[];n.propertyList.forEach((function(e,n){0!==n&&t.push(e)})),void 0===e.connections&&(e.connections=[]),e.connections.push(t)}else if("Properties70"===n.name){Object.keys(n).forEach((function(t){e[t]=n[t]}))}else if("Properties70"===t&&"P"===n.name){let t=n.propertyList[0],r=n.propertyList[1];const o=n.propertyList[2],i=n.propertyList[3];let a;0===t.indexOf("Lcl ")&&(t=t.replace("Lcl ","Lcl_")),0===r.indexOf("Lcl ")&&(r=r.replace("Lcl ","Lcl_")),a="Color"===r||"ColorRGB"===r||"Vector"===r||"Vector3D"===r||0===r.indexOf("Lcl_")?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],e[t]={type:r,type2:o,flag:i,value:a}}else void 0===e[n.name]?"number"==typeof n.id?(e[n.name]={},e[n.name][n.id]=n):e[n.name]=n:"PoseNode"===n.name?(Array.isArray(e[n.name])||(e[n.name]=[e[n.name]]),e[n.name].push(n)):void 0===e[n.name][n.id]&&(e[n.name][n.id]=n)}parseProperty(t){const e=t.getString(1);let n;switch(e){case"C":return t.getBoolean();case"D":return t.getFloat64();case"F":return t.getFloat32();case"I":return t.getInt32();case"L":return t.getInt64();case"R":return n=t.getUint32(),t.getArrayBuffer(n);case"S":return n=t.getUint32(),t.getString(n);case"Y":return t.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const r=t.getUint32(),o=t.getUint32(),i=t.getUint32();if(0===o)switch(e){case"b":case"c":return t.getBooleanArray(r);case"d":return t.getFloat64Array(r);case"f":return t.getFloat32Array(r);case"i":return t.getInt32Array(r);case"l":return t.getInt64Array(r)}void 0===wn&&console.error("THREE.FBXLoader: External library fflate.min.js required.");const a=We(new Uint8Array(t.getArrayBuffer(i))),s=new Ln(a.buffer);switch(e){case"b":case"c":return s.getBooleanArray(r);case"d":return s.getFloat64Array(r);case"f":return s.getFloat32Array(r);case"i":return s.getInt32Array(r);case"l":return s.getInt64Array(r)}default:throw new Error("THREE.FBXLoader: Unknown property type "+e)}}}class Ln{constructor(t,e){this.dv=new DataView(t),this.offset=0,this.littleEndian=void 0===e||e}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(t){this.offset+=t}getBoolean(){return 1==(1&this.getUint8())}getBooleanArray(t){const e=[];for(let n=0;n<t;n++)e.push(this.getBoolean());return e}getUint8(){const t=this.dv.getUint8(this.offset);return this.offset+=1,t}getInt16(){const t=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}getInt32(){const t=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}getInt32Array(t){const e=[];for(let n=0;n<t;n++)e.push(this.getInt32());return e}getUint32(){const t=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}getInt64(){let t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),2147483648&e?(e=4294967295&~e,t=4294967295&~t,4294967295===t&&(e=e+1&4294967295),t=t+1&4294967295,-(4294967296*e+t)):4294967296*e+t}getInt64Array(t){const e=[];for(let n=0;n<t;n++)e.push(this.getInt64());return e}getUint64(){let t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),4294967296*e+t}getFloat32(){const t=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}getFloat32Array(t){const e=[];for(let n=0;n<t;n++)e.push(this.getFloat32());return e}getFloat64(){const t=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}getFloat64Array(t){const e=[];for(let n=0;n<t;n++)e.push(this.getFloat64());return e}getArrayBuffer(t){const e=this.dv.buffer.slice(this.offset,this.offset+t);return this.offset+=t,e}getString(t){let e=[];for(let r=0;r<t;r++)e[r]=this.getUint8();const n=e.indexOf(0);return n>=0&&(e=e.slice(0,n)),a.decodeText(new Uint8Array(e))}}class zn{add(t,e){this[t]=e}}function On(t){const e=t.match(/FBXVersion: (\d+)/);if(e){return parseInt(e[1])}throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function Rn(t){return t/46186158e3}const Nn=[];function _n(t,e,n,r){let o;switch(r.mappingType){case"ByPolygonVertex":o=t;break;case"ByPolygon":o=e;break;case"ByVertice":o=n;break;case"AllSame":o=r.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+r.mappingType)}"IndexToDirect"===r.referenceType&&(o=r.indices[o]);const i=o*r.dataSize,a=i+r.dataSize;return function(t,e,n,r){for(let o=n,i=0;o<r;o++,i++)t[i]=e[o];return t}(Nn,r.buffer,i,a)}const Bn=new U,Un=new r;function jn(t){const e=new g,n=new g,o=new g,i=new g,a=new g,s=new g,l=new g,u=new g,c=new g,f=new g,h=new g,p=new g,d=t.inheritType?t.inheritType:0;if(t.translation&&e.setPosition(Un.fromArray(t.translation)),t.preRotation){const e=t.preRotation.map(C.degToRad);e.push(t.eulerOrder),n.makeRotationFromEuler(Bn.fromArray(e))}if(t.rotation){const e=t.rotation.map(C.degToRad);e.push(t.eulerOrder),o.makeRotationFromEuler(Bn.fromArray(e))}if(t.postRotation){const e=t.postRotation.map(C.degToRad);e.push(t.eulerOrder),i.makeRotationFromEuler(Bn.fromArray(e)),i.invert()}t.scale&&a.scale(Un.fromArray(t.scale)),t.scalingOffset&&l.setPosition(Un.fromArray(t.scalingOffset)),t.scalingPivot&&s.setPosition(Un.fromArray(t.scalingPivot)),t.rotationOffset&&u.setPosition(Un.fromArray(t.rotationOffset)),t.rotationPivot&&c.setPosition(Un.fromArray(t.rotationPivot)),t.parentMatrixWorld&&(h.copy(t.parentMatrix),f.copy(t.parentMatrixWorld));const m=n.clone().multiply(o).multiply(i),v=new g;v.extractRotation(f);const y=new g;y.copyPosition(f);const w=y.clone().invert().multiply(f),x=v.clone().invert().multiply(w),b=a,I=new g;if(0===d)I.copy(v).multiply(m).multiply(x).multiply(b);else if(1===d)I.copy(v).multiply(x).multiply(m).multiply(b);else{const t=(new g).scale((new r).setFromMatrixScale(h)).clone().invert(),e=x.clone().multiply(t);I.copy(v).multiply(m).multiply(e).multiply(b)}const T=c.clone().invert(),S=s.clone().invert();let P=e.clone().multiply(u).multiply(c).multiply(n).multiply(o).multiply(i).multiply(T).multiply(l).multiply(s).multiply(a).multiply(S);const A=(new g).copyPosition(P),k=f.clone().multiply(A);return p.copyPosition(k),P=p.clone().multiply(I),P.premultiply(f.invert()),P}function Gn(t){const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(t=t||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[t]}function Vn(t){return t.split(",").map((function(t){return parseFloat(t)}))}function Xn(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=t.byteLength),a.decodeText(new Uint8Array(t,e,n))}function Wn(t,e,n){return t.slice(0,e).concat(n).concat(t.slice(e))}var Hn={surroundLineGeometry:t=>new X(t.geometry)};const Yn="\nprecision mediump float;\n\nfloat distanceTo(vec2 src, vec2 dst) {\n    float dx = src.x - dst.x;\n    float dy = src.y - dst.y;\n    float dv = dx * dx + dy * dy;\n    return sqrt(dv);\n} \n\nfloat lerp(float x, float y, float t) {\n    return (1.0 - t) * x + t * y;\n}\n\n#define PI 3.14159265359\n#define PI2 6.28318530718\n\n";var Zn={base:Yn,surroundLine:{vertexShader:"\n    #define PI 3.14159265359\n\n    uniform mediump float uStartTime;\n    uniform mediump float time;\n    uniform mediump float uRange;\n    uniform mediump float uSpeed;\n\n    uniform vec3 uColor;\n    uniform vec3 uActive;\n    uniform vec3 uMin;\n    uniform vec3 uMax;\n\n    varying vec3 vColor;\n\n    float lerp(float x, float y, float t) {\n        return (1.0 - t) * x + t * y;\n    }\n    void main() { \n        if (uStartTime >= 0.99) {\n            float iTime = mod(time * uSpeed - uStartTime, 1.0);\n            float rangeY = lerp(uMin.y, uMax.y, iTime);\n            if (rangeY < position.y && rangeY > position.y - uRange) {\n                float index = 1.0 - sin((position.y - rangeY) / uRange * PI);\n                float r = lerp(uActive.r, uColor.r, index);\n                float g = lerp(uActive.g, uColor.g, index);\n                float b = lerp(uActive.b, uColor.b, index);\n\n                vColor = vec3(r, g, b);\n            } else {\n                vColor = uColor;\n            }\n        }\n        vec3 vPosition = vec3(position.x, position.y, position.z * uStartTime);\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(vPosition, 1.0);\n    } \n    ",fragmentShader:` \n    ${Yn} \n    uniform float time;\n    uniform float uOpacity;\n    uniform float uStartTime;\n\n    varying vec3 vColor; \n\n    void main() {\n\n        gl_FragColor = vec4(vColor, uOpacity * uStartTime);\n    }\n    `}},Kn={forMaterial(t,e){if(!e||!t)return!1;Array.isArray(t)?t.forEach((t=>{e(t)})):e(t)}};const qn={vertexShader:"\n    varying vec2 v_position;\n    \n    void main() {\n        v_position = vec2(position.x, position.y);\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    }",fragmentShader:"\n    \nprecision mediump float;\n \nfloat atan2(float y, float x){\n  float t0, t1, t2, t3, t4;\n  t3 = abs(x);\n  t1 = abs(y);\n  t0 = max(t3, t1);\n  t1 = min(t3, t1);\n  t3 = float(1) / t0;\n  t3 = t1 * t3;\n  t4 = t3 * t3;\n  t0 = -float(0.013480470);\n  t0 = t0 * t4 + float(0.057477314);\n  t0 = t0 * t4 - float(0.121239071);\n  t0 = t0 * t4 + float(0.195635925);\n  t0 = t0 * t4 - float(0.332994597);\n  t0 = t0 * t4 + float(0.999995630);\n  t3 = t0 * t3;\n  t3 = (abs(y) > abs(x)) ? float(1.570796327) - t3 : t3;\n  t3 = (x < 0.0) ?  float(3.141592654) - t3 : t3;\n  t3 = (y < 0.0) ? -t3 : t3;\n  return t3;\n}\n// 计算距离\nfloat distanceTo(vec2 src, vec2 dst) {\n\tfloat dx = src.x - dst.x;\n\tfloat dy = src.y - dst.y;\n\tfloat dv = dx * dx + dy * dy;\n\treturn sqrt(dv);\n}\n\n#define PI 3.14159265359\n#define PI2 6.28318530718\n\nuniform vec3 u_color;\nuniform float time;\nuniform float u_opacity;\nuniform float u_radius;\nuniform float u_width;\nuniform float u_speed;\n\nvarying vec2 v_position;\n\n     \n    void main() {\n        float d_time = u_speed * time;\n\n        float angle = atan2(v_position.x, v_position.y) + PI;\n        \n        float angleT = mod(angle + d_time, PI2);\n\n        float width = u_width;\n    \n        float d_opacity = 0.0;\n\n        // 当前位置离中心位置\n        float length = distanceTo(vec2(0.0, 0.0), v_position);\n        \n        float bw = 5.0;\n        if (length < u_radius && length > u_radius - bw) {\n            float o = (length - (u_radius - bw)) / bw;\n            d_opacity = sin(o * PI); \n        }\n\n        if (length < u_radius - bw / 1.1) {\n            d_opacity = 1.0 - angleT / PI * (PI / width);\n        } \n\n        if (length > u_radius) { d_opacity = 0.0; }\n \n        gl_FragColor = vec4(u_color, d_opacity * u_opacity);\n    }"};const $n=[{position:{x:666,y:22,z:0},radius:150,color:"#ff0000",opacity:.5,speed:2},{position:{x:-666,y:25,z:202},radius:320,color:"#efad35",opacity:.6,speed:1}],Qn=[{position:{x:-150,y:15,z:100},speed:.5,color:"#efad35",opacity:.6,radius:420,height:120,renderOrder:5}],Jn=[{source:{x:-150,y:15,z:100},target:{x:-666,y:25,z:202},range:120,height:100,color:"#efad35",speed:1,size:30},{source:{x:-150,y:15,z:100},target:{x:666,y:22,z:0},height:300,range:150,color:"#ff0000",speed:1,size:40}];class tr{constructor(){e(this,"animate",(t=>{if(t>1)return!1;this.time.value+=t,this.isStart&&(this.StartTime.value+=.5*t,this.StartTime.value>=1&&(this.StartTime.value=1,this.isStart=!1))})),this.fbxLoader=new An,this.group=new y,this.effectGroup=new y,this.group.add(this.effectGroup),this.surroundLineMaterial=null,this.time={value:0},this.StartTime={value:0},this.isStart=!1;const t=["CITY_UNTRIANGULATED"],n=["LANDMASS"];this.loadFbx("./assets/shanghai.68103d2f.FBX").then((e=>{this.group.add(e),e.traverse((e=>{t.includes(e.name)&&(this.setCityMaterial(e),this.surroundLine(e)),n.includes(e.name)&&this.setFloor(e)}))})),this.init()}loadFbx(t){return new Promise(((e,n)=>{try{this.fbxLoader.load(t,(t=>{e(t)}))}catch(ir){n(ir)}}))}init(){setTimeout((()=>{this.isStart=!0,$n.forEach((t=>{const e=function(t){const{radius:e=50,color:n="#fff",speed:r=1,opacity:o=1,angle:i=Math.PI,position:a={x:0,y:0,z:0},rotation:s={x:-Math.PI/2,y:0,z:0}}=t,l=2*e,u=new W(l,l,1,1),c=new H({uniforms:{u_radius:{value:e},u_speed:{value:r},u_opacity:{value:o},u_width:{value:i},u_color:{value:new d(n)},time:{value:0}},transparent:!0,depthWrite:!1,side:Y,vertexShader:qn.vertexShader,fragmentShader:qn.fragmentShader}),f=new M(u,c);return f.rotation.set(s.x,s.y,s.z),f.position.copy(a),f}(t);e.material.uniforms.time=this.time,this.effectGroup.add(e)})),Qn.forEach((t=>{const e=function(t={}){const{radius:e,height:n,opacity:r,color:o,speed:i,renderOrder:a}=t,s=new Z(e,e,n,32,1,!0);s.translate(0,n/2,0);const l=new H({uniforms:{u_height:{value:n},u_speed:{value:i||1},u_opacity:{value:r},u_color:{value:new d(o)},time:{value:0}},transparent:!0,depthWrite:!1,depthTest:!1,side:Y,vertexShader:"\nuniform vec3 u_color;\n\nuniform float time;\nuniform float u_height;\n \nvarying float v_opacity;\n\nvoid main() {\n\n    vec3 vPosition = position * mod(time, 1.0);\n\n    v_opacity = mix(1.0, 0.0, position.y / u_height);\n \n    gl_Position = projectionMatrix * modelViewMatrix * vec4(vPosition, 1.0);\n}\n",fragmentShader:" \nuniform vec3 u_color;\nuniform float u_opacity;\n \nvarying float v_opacity;\n\nvoid main() { \n    gl_FragColor = vec4(u_color, v_opacity * u_opacity);\n}\n"}),u=new M(s,l);return u.renderOrder=a||1,u}(t);e.material.uniforms.time=this.time,this.effectGroup.add(e)})),Jn.forEach((t=>{const e=function(t){const{source:e,target:n,height:o,size:i,color:a,range:s}=t,l=[],u=[],c=[],f=[],h=new r(e.x,e.y,e.z),p=new r(n.x,n.y,n.z),m=p.clone().lerp(h,.5);m.y+=o;const v=parseInt(h.distanceTo(m)+p.distanceTo(m));new K(h,m,p).getPoints(v).forEach(((t,e)=>{const n=e/(v-1);l.push({x:t.x,y:t.y,z:t.z}),c.push(n),f.push(e)})),l.forEach((t=>{u.push(t.x,t.y,t.z)}));const g=new z;g.setAttribute("position",new O(u,3)),g.setAttribute("index",new O(c,1)),g.setAttribute("current",new O(f,1));const y=new H({transparent:!0,depthWrite:!1,depthTest:!1,blending:q,uniforms:{uColor:{value:new d(a)},uRange:{value:s||100},uSize:{value:i},uTotal:{value:v},time:{value:0}},vertexShader:"\n        attribute float index;\n        attribute float current;\n        uniform float time;\n        uniform float uSize;\n        uniform float uRange; // 展示区间\n        uniform float uTotal; // 粒子总数\n        uniform vec3 uColor; \n        varying vec3 vColor;\n        varying float vOpacity;\n        void main() {\n            // 需要当前显示的索引\n            float size = uSize;\n            float showNumber = uTotal * mod(time, 1.1);\n            if (showNumber > current && showNumber < current + uRange) {\n                float uIndex = ((current + uRange) - showNumber) / uRange;\n                size *= uIndex;\n                vOpacity = 1.0;\n            } else {\n                vOpacity = 0.0;\n            }\n\n            // 顶点着色器计算后的Position\n            vColor = uColor;\n            vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n            gl_Position = projectionMatrix * mvPosition; \n            // 大小\n            gl_PointSize = size * 300.0 / (-mvPosition.z);\n        }",fragmentShader:"\n        varying vec3 vColor; \n        varying float vOpacity;\n        void main() {\n            gl_FragColor = vec4(vColor, vOpacity);\n        }"});return new $(g,y)}(t);e.material.uniforms.time=this.time,e.renderOrder=10,this.effectGroup.add(e)}))}),1e3)}setFloor(t){Kn.forMaterial(t.material,(t=>{t.color.setStyle("#040912")}))}setCityMaterial(t){t.geometry.computeBoundingBox(),t.geometry.computeBoundingSphere();const{geometry:e}=t,{center:n,radius:o}=e.boundingSphere,{max:i,min:a}=e.boundingBox,s=new r(i.x-a.x,i.y-a.y,i.z-a.z);Kn.forMaterial(t.material,(t=>{t.transparent=!0,t.color.setStyle("#1B3045"),t.onBeforeCompile=t=>{t.uniforms.time=this.time,t.uniforms.uStartTime=this.StartTime,t.uniforms.uCenter={value:n},t.uniforms.uSize={value:s},t.uniforms.uMax={value:i},t.uniforms.uMin={value:a},t.uniforms.uTopColor={value:new d("#FFFFDC")},t.uniforms.uSwitch={value:new r(0,0,0)},t.uniforms.uDiffusion={value:new r(1,120,600)},t.uniforms.uDiffusionCenter={value:new r(0,0,0)},t.uniforms.uFlow={value:new r(1,10,20)},t.uniforms.uColor={value:new d("#5588aa")},t.uniforms.uFlowColor={value:new d("#5588AA")},t.uniforms.uOpacity={value:1},t.uniforms.uRadius={value:o};t.fragmentShader=t.fragmentShader.replace("void main() {","\n    float distanceTo(vec2 src, vec2 dst) {\n        float dx = src.x - dst.x;\n        float dy = src.y - dst.y;\n        float dv = dx * dx + dy * dy;\n        return sqrt(dv);\n    }\n\n    float lerp(float x, float y, float t) {\n        return (1.0 - t) * x + t * y;\n    }\n\n    vec3 getGradientColor(vec3 color1, vec3 color2, float index) {\n        float r = lerp(color1.r, color2.r, index);\n        float g = lerp(color1.g, color2.g, index);\n        float b = lerp(color1.b, color2.b, index);\n        return vec3(r, g, b);\n    }\n\n    varying vec4 vPositionMatrix;\n    varying vec3 vPosition;\n\n    uniform float time;\n    // 扩散参数\n    uniform float uRadius;\n    uniform float uOpacity;\n    // 初始动画参数\n    uniform float uStartTime;\n\n    uniform vec3 uMin;\n    uniform vec3 uMax;\n    uniform vec3 uSize;\n    uniform vec3 uFlow;\n    uniform vec3 uColor;\n    uniform vec3 uCenter;\n    uniform vec3 uSwitch;\n    uniform vec3 uTopColor;\n    uniform vec3 uFlowColor;\n    uniform vec3 uDiffusion;\n    uniform vec3 uDiffusionCenter;\n\n    void main() {\n        "),t.fragmentShader=t.fragmentShader.replace("gl_FragColor = vec4( outgoingLight, diffuseColor.a );","\n    vec3 distColor = outgoingLight;\n    float dstOpacity = diffuseColor.a;\n\n    float indexMix = vPosition.z / (uSize.z * 0.6);\n    distColor = mix(distColor, uTopColor, indexMix);\n\n    // 开启扩散波\n    vec2 position2D = vec2(vPosition.x, vPosition.y);\n    if (uDiffusion.x > 0.5) {\n        // 扩散速度\n        float dTime = mod(time * uDiffusion.z, uRadius * 2.0);\n        // 当前的离中心点距离\n        float uLen = distanceTo(position2D, vec2(uCenter.x, uCenter.z));\n\n        // 扩散范围\n        if (uLen < dTime && uLen > dTime - uDiffusion.y) {\n            // 颜色渐变\n            float dIndex = sin((dTime - uLen) / uDiffusion.y * PI);\n            distColor = mix(uColor, distColor, 1.0 - dIndex);\n        }\n    }\n\n    // 流动效果\n    if (uFlow.x > 0.5) {\n        // 扩散速度\n        float dTime = mod(time * uFlow.z, uSize.z);\n        // 流动范围\n        float topY = vPosition.z + uFlow.y;\n        if (dTime > vPosition.z && dTime < topY) {\n            // 颜色渐变\n            float dIndex = sin((topY - dTime) / uFlow.y * PI);\n\n            distColor = mix(distColor, uFlowColor,  dIndex);\n        }\n    }\n\n\n    gl_FragColor = vec4(distColor, dstOpacity * uStartTime);\n        ");t.vertexShader=t.vertexShader.replace("void main() {","\n    varying vec4 vPositionMatrix;\n    varying vec3 vPosition;\n    uniform float uStartTime;\n    void main() {\n            vPositionMatrix = projectionMatrix * vec4(position, 1.0);\n            vPosition = position;\n            "),t.vertexShader=t.vertexShader.replace("#include <begin_vertex>","\n    vec3 transformed = vec3(position.x, position.y, position.z * uStartTime);\n            ")}}))}surroundLine(t){const e=Hn.surroundLineGeometry(t),n=new r;t.getWorldPosition(n);const{max:o,min:i}=t.geometry.boundingBox,a=new r(o.x-i.x,o.y-i.y,o.z-i.z),s=this.createSurroundLineMaterial({max:o,min:i,size:a}),l=new Q(e,s);l.name="surroundLine",l.scale.copy(t.scale),l.rotation.copy(t.rotation),l.position.copy(n),this.effectGroup.add(l)}createSurroundLineMaterial({max:t,min:e}){return this.surroundLineMaterial||(this.surroundLineMaterial=new H({transparent:!0,uniforms:{uColor:{value:new d("#4C8BF5")},uActive:{value:new d("#fff")},time:this.time,uOpacity:{value:.6},uMax:{value:t},uMin:{value:e},uRange:{value:200},uSpeed:{value:.2},uStartTime:this.StartTime},vertexShader:Zn.surroundLine.vertexShader,fragmentShader:Zn.surroundLine.fragmentShader})),this.surroundLineMaterial}}const er={};var nr=rt({name:"TechnologyCity",mounted(){const t=document.querySelector("canvas.webgl"),e=new J,n=new L(11382189);e.add(n);const r=new A(16777215,.5);r.position.set(100,100,0),e.add(r);const o={width:window.innerWidth,height:window.innerHeight};window.addEventListener("resize",(()=>{o.width=window.innerWidth,o.height=window.innerHeight,i.aspect=o.width/o.height,i.updateProjectionMatrix(),s.setSize(o.width,o.height),s.setPixelRatio(Math.min(window.devicePixelRatio,2))}));const i=new T(45,o.width/o.height,1,1e4);i.position.set(1200,700,121),e.add(i);const a=new nt(i,t);a.enableDamping=!0;const s=new tt({canvas:t,antialias:!0,alpha:!0});s.setSize(o.width,o.height),s.setPixelRatio(Math.min(window.devicePixelRatio,2)),s.setClearColor(new d("#32373E"),1);const l=new tr({});e.add(l.group);const u=new et,c=()=>{const t=u.getDelta();l.animate(t),a.update(),s.render(e,i),window.requestAnimationFrame(c)};c()}},(function(){var t=this.$createElement;return(this._self._c||t)("canvas",{staticClass:"webgl"})}),[],!1,rr,null,null,null);function rr(t){for(let e in er)this[e]=er[e]}var or=function(){return nr.exports}();export{or as default};
